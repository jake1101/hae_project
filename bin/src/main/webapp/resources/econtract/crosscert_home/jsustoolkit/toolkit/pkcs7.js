(function(){function s(d){var h=d.jsustoolkitErrCode=d.jsustoolkitErrCode||{},a=d.asn1,m=d.pkcs7=d.pkcs7||{};m.messageFromPem=function(b){if(null==f||"undefined"==typeof f)throw{code:"113001",message:h["113001"]};b=d.pki.pemToDer(b);var f=a.fromDer(b);return m.messageFromAsn1(f)};m.messageToPem=function(b,f){if(null==b||"undefined"==typeof b)throw{code:"113002",message:h["113002"]};var c=a.toDer(b.toAsn1()),c=d.util.encode64(c.getBytes(),f||64);return"-----BEGIN PKCS7-----\r\n"+c+"\r\n-----END PKCS7-----"};m.messageFromBase64=function(b){if(null==b||"undefined"==typeof b)throw{code:"113003",message:h["113003"]};b=d.pki.base64ToDer(b);b=a.fromDer(b);return m.messageFromAsn1(b)};m.messageToBase64=function(b){if(null==b||"undefined"==typeof b)throw{code:"113004",message:h["113004"]};b=a.toDer(b.toAsn1());return d.util.encode64(b.getBytes())};m.messageFromAsn1=function(b){if(null==b||"undefined"==typeof b)throw{code:"113005",message:h["113005"]};var f={},c=[];if(!a.validate(b,m.asn1.contentInfoValidator,f,c))throw{code:"113006",message:h["113006"],errors:c};b=a.derToOid(f.contentType);switch(b){case d.pki.oids.envelopedData:b=m.createEnvelopedData();break;case d.pki.oids.encryptedData:b=m.createEncryptedData();break;case d.pki.oids.signedData:b=m.createSignedData();break;default:throw{code:"113007",message:h["113007"]+"("+b+")"};}b.fromAsn1(f.content.value[0]);return b};var p=function(b){var f={},c=[];if(!a.validate(b,m.asn1.recipientInfoValidator,f,c))throw{code:"113008",message:h["113008"],errors:c};return{version:f.version.charCodeAt(0),issuer:d.pki.RDNAttributesAsArray(f.issuer),serialNumber:d.util.createBuffer(f.serial).toHex(),encContent:{algorithm:a.derToOid(f.encAlgorithm),parameter:f.encParameter.value,content:f.encKey}}},r=function(b){return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(b.version)),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[d.pki.distinguishedNameToAsn1({attributes:b.issuer}),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,d.util.hexToBytes(b.serialNumber))]),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.encContent.algorithm).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]),a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,b.encContent.content)])},s=function(a){for(var f=[],c=0;c<a.length;c++)f.push(r(a[c]));return f},q=function(b){return[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.data).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.algorithm).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,b.parameter.getBytes())]),a.create(a.Class.CONTEXT_SPECIFIC,0,!1,b.content.getBytes())]},t=function(b,f,c){if(null==b||"undefined"==typeof b)throw{code:"113009",message:h["113009"]};if(null==f||"undefined"==typeof f)throw{code:"113010",message:h["113010"]};if(null==c||"undefined"==typeof c)throw{code:"113011",message:h["113011"]};var e={},g=[];if(!a.validate(f,c,e,g))throw{code:"113012",message:h["113012"],errors:g};if(a.derToOid(e.contentType)!==d.pki.oids.data)throw{code:"113013",message:h["113013"]};if(e.encContent){f="";if(e.encContent.constructor===Array)for(c=0;c<e.encContent.length;++c){if(e.encContent[c].type!==a.Type.OCTETSTRING)throw{code:"113014",message:h["113014"]};f+=e.encContent[c].value}else f=e.encContent;b.encContent={algorithm:a.derToOid(e.encAlgorithm),parameter:d.util.createBuffer(e.encParameter.value),content:d.util.createBuffer(f)}}if(e.content){f="";if(e.content.constructor===Array)for(c=0;c<e.content.length;++c){if(e.content[c].type!==a.Type.OCTETSTRING)throw{code:"113015",message:h["113015"]};f+=e.content[c].value}else f=e.content.constructor===Object?e.content.value[0].value:e.content;b.content=d.util.createBuffer(f)}if(e.signature){for(c=0;c<e.certificates.length;++c)b.certificates.push(d.pki.certificateFromAsn1(e.certificates[c]));b.crls=e.crls;b.signContent.push(e.signerInfos);b.digestAlgo.push(a.derToOid(e.digestAlgorithm));b.authenticatedAttributes.push(e.authenticatedAttributes);b.signature.push(e.signature)}b.version=e.version.charCodeAt(0);return b.rawCapture=e},u=function(a){if(null==a||"undefined"==typeof a)throw{code:"113016",message:h["113016"]};if(void 0===a.encContent.key)throw{code:"113017",message:h["113017"]};if(void 0===a.content){var f;switch(a.encContent.algorithm){case d.pki.oids["aes128-CBC"]:case d.pki.oids["aes192-CBC"]:case d.pki.oids["aes256-CBC"]:f=d.aes.createDecryptionCipher(a.encContent.key);break;case d.pki.oids["des-EDE3-CBC"]:f=d.des.createDecryptionCipher(a.encContent.key);break;case d.pki.oids["seed-CBC"]:f=d.seed.createDecryptionCipher(a.encContent.key);break;default:throw{code:"113018",message:h["113018"]+a.encContent.algorithm};}f.start(a.encContent.parameter);f.update(a.encContent.content);if(!f.finish())throw{code:"113019",message:h["113019"]};a.content=f.output}},v=function(a,f,c){if(null==a||"undefined"==typeof a)throw{code:"113020",message:h["113020"]};if(void 0===a.encContent.content){c=c||a.encContent.algorithm;f=f||a.encContent.key;var e,g,k;switch(c){case d.pki.oids["aes128-CBC"]:g=e=16;k=d.aes.createEncryptionCipher;break;case d.pki.oids["aes192-CBC"]:e=24;g=16;k=d.aes.createEncryptionCipher;break;case d.pki.oids["aes256-CBC"]:e=32;g=16;k=d.aes.createEncryptionCipher;break;case d.pki.oids["des-EDE3-CBC"]:e=24;g=8;k=d.des.createEncryptionCipher;break;case d.pki.oids["seed-CBC"]:g=e=16;k=d.seed.createEncryptionCipher;break;default:throw{code:"113021",message:h["113021"]+c};}if(void 0===f)f=d.util.createBuffer(d.random.getBytes(e));else if(f.length()!=e)throw{code:"113022",message:h["113022"]+"got "+f.length()+" bytes, expected "+e};a.encContent.algorithm=c;a.encContent.key=f;a.encContent.parameter=d.util.createBuffer(d.random.getBytes(g));f=k(f);f.start(a.encContent.parameter.copy());f.update(a.content);if(!f.finish())throw{code:"113023",message:h["113023"]};a.encContent.content=f.output}},x=function(b){if(null==b||"undefined"==typeof b)throw{code:"113024",message:h["113024"]};var f=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);f.value.push(a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(b.version)));f.value.push(a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[d.pki.distinguishedNameToAsn1({attributes:b.issuer}),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,d.util.hexToBytes(b.serialNumber))]));f.value.push(a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.digestAlgorithm).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]));b.authAttr&&f.value.push(a.create(a.Class.CONTEXT_SPECIFIC,0,!0,b.authAttr.value));f.value.push(a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.digestEncAlgorithm).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]));f.value.push(a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,b.signature));return f},w=function(b){if(null==b||"undefined"==typeof b)throw{code:"113025",message:h["113025"]};var f=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);f.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.contentType).getBytes()));f.value.push(a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.data).getBytes())]));var c=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);c.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.signingTime).getBytes()));c.value.push(a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[a.create(a.Class.UNIVERSAL,a.Type.GENERALIZEDTIME,!1,a.dateToGeneralizedTime(b.signTime))]));var e=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);e.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.messageDigest).getBytes()));e.value.push(a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,b.digest)]));b=a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[]);b.value.push(f);b.value.push(c);b.value.push(e);return b};m.createSignedData=function(){var b=null;return b={type:d.pki.oids.signedData,version:1,certificates:[],crls:[],signature:[],signContent:[],authenticatedAttributes:[],digestAlgo:[],fromAsn1:function(a){if(null==a||"undefined"==typeof a)throw{code:"113026",message:h["113026"]};t(b,a,m.asn1.signedDataValidator)},toAsn1:function(){var f=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);f.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.type).getBytes()));var c=a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[]),e=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);e.value.push(a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(b.version)));for(var g=a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[]),k=0;k<b.signContent.length;k++)g.value.push(a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.signContent[k].digestAlgorithm).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]));e.value.push(g);b.content?e.value.push(a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.data).getBytes()),a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,b.content.getBytes())])])):e.value.push(a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.data).getBytes())]));if(0!=b.certificates.length){g=a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[]);for(k=0;k<b.certificates.length;k++)g.value.push(d.pki.certificateToAsn1(b.certificates[k]));e.value.push(g)}if(0!=b.crls.length){g=a.create(a.Class.CONTEXT_SPECIFIC,1,!0,[]);for(k=0;k<b.crls.length;k++)g.value.push(b.crls[k].getBytes());e.value.push(g)}if(0<b.signContent.length){g=a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[]);for(k=0;k<b.signContent.length;k++)g.value.push(x(b.signContent[k]));e.value.push(g)}else throw{code:"113027",message:h["113027"]};c.value.push(e);f.value.push(c);return f},signWithDecPriKey:function(f,c,e,g,k){if(null==c||"undefined"==typeof c)throw{code:"113028",message:h["113028"]};if(null==e||"undefined"==typeof e)throw{code:"113029",message:h["113029"]};if(null==f||"undefined"==typeof f)f="";b.content=d.util.createBuffer(f,"utf8");f={version:1,digestAlgorithm:d.pki.oids.sha256};var n=d.pki.oids[c.siginfo.algorithmOid].split("With");f.digestAlgorithm=d.pki.oids[n[0]];f.digestEncAlgorithm=d.pki.oids[n[1]];f.issuer=c.issuer.attributes;f.serialNumber=c.serialNumber;b.certificates.push(c);f.signTime=void 0!==typeof g&&null!=g?g:new Date;void 0!==typeof k&&null!=k&&b.crls.push(k);c=d.md.algorithms[d.pki.oids[f.digestAlgorithm]].create();c.update(b.content.bytes());f.digest=c.digest().bytes();f.authAttr=w(f);c=d.md.algorithms[d.pki.oids[f.digestAlgorithm]].create();g=a.toDer(f.authAttr);c.update(g.bytes());f.signature=e.sign(c);b.signContent.push(f)},sign:function(a,c,e,g,k,n){if(null==g||"undefined"==typeof g)throw{code:"113030",message:h["113030"]};if(null==e||"undefined"==typeof e)throw{code:"113031",message:h["113031"]};e=d.pkcs8.decryptPrivateKeyInfo(e,g);e=d.pki.privateKeyFromAsn1(e);b.signWithDecPriKey(a,c,e,k,n)},signWithHashWithDecPriKey:function(f,c,e,g,k,n){if(null==e||"undefined"==typeof e)throw{code:"113028",message:h["113028"]};if(null==g||"undefined"==typeof g)throw{code:"113029",message:h["113029"]};if(null==f||"undefined"==typeof f)f="";var l={version:1,digestAlgorithm:d.pki.oids.sha256},m=d.pki.oids[e.siginfo.algorithmOid].split("With");l.digestAlgorithm=d.pki.oids[c];l.digestEncAlgorithm=d.pki.oids[m[1]];l.issuer=e.issuer.attributes;l.serialNumber=e.serialNumber;b.certificates.push(e);l.signTime=void 0!==typeof k&&null!=k?k:new Date;void 0!==typeof n&&null!=n&&b.crls.push(n);l.digest=f;l.authAttr=w(l);md=d.md.algorithms[d.pki.oids[l.digestAlgorithm]].create();f=a.toDer(l.authAttr);md.update(f.bytes());l.signature=g.sign(md);b.signContent.push(l)},signWithHashData:function(a,c,e,g,k,n,l){if(null==k||"undefined"==typeof k)throw{code:"113030",message:h["113030"]};if(null==g||"undefined"==typeof g)throw{code:"113031",message:h["113031"]};g=d.pkcs8.decryptPrivateKeyInfo(g,k);g=d.pki.privateKeyFromAsn1(g);b.signWithHashWithDecPriKey(a,c,e,g,n,l)},signWithHashDataNP1:function(a,c,e,g,k,n){if(null==g||"undefined"==typeof g)throw{code:"113028",message:h["113028"]};if(null==c||"undefined"==typeof c)c="";if(null==a||"undefined"==typeof a)a="";var l={version:1,digestAlgorithm:d.pki.oids.sha256},m=d.pki.oids[g.siginfo.algorithmOid].split("With");l.digestAlgorithm=d.pki.oids[e];l.digestEncAlgorithm=d.pki.oids[m[1]];l.issuer=g.issuer.attributes;l.serialNumber=g.serialNumber;b.certificates.push(g);l.signTime=void 0!==typeof k&&null!=k?k:new Date;void 0!==typeof n&&null!=n&&b.crls.push(n);l.digest=c;l.signature=a;b.signContent.push(l)},signWithP1:function(a,c,e,g,k){if(null==e||"undefined"==typeof e)throw{code:"113028",message:h["113028"]};if(null==c||"undefined"==typeof c)c="";b.content=d.util.createBuffer(c,"utf8");c={version:1,digestAlgorithm:d.pki.oids.sha256};var n=d.pki.oids[e.siginfo.algorithmOid].split("With");c.digestAlgorithm=d.pki.oids[n[0]];c.digestEncAlgorithm=d.pki.oids[n[1]];c.issuer=e.issuer.attributes;c.serialNumber=e.serialNumber;b.certificates.push(e);c.signTime=void 0!==typeof g&&null!=g?g:new Date;void 0!==typeof k&&null!=k&&b.crls.push(k);e=d.md.algorithms[d.pki.oids[c.digestAlgorithm]].create();e.update(b.content.bytes());c.digest=e.digest().bytes();c.signature=a;b.signContent.push(c)},verifyWithHash:function(f){if("undefined"!=typeof certs)if(cert.constructor===Array)for(var c in certs)b.certificates.push(certs[c]);else b.certificates.push(certs);if(null==f||"undefined"==typeof f)throw{code:"113043",message:h["113043"]};if(b.certificates.length!=b.signContent.length)throw{code:"113042",message:h["113042"]};for(c=0;c<b.certificates.length;c++){var e=b.certificates[c].publicKey,g,k=a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[]);if("undefined"!=typeof b.authenticatedAttributes[0])for(var n in b.authenticatedAttributes[c]){d.pki.oids.messageDigest!=a.derToOid(b.authenticatedAttributes[c][n].value[0].value)&&d.pki.oids.signingTime==a.derToOid(b.authenticatedAttributes[c][n].value[0].value)&&(23==b.authenticatedAttributes[c][n].value[1].value[0].type?b.signTime=a.utcTimeToDate(b.authenticatedAttributes[c][n].value[1].value[0].value):24==b.authenticatedAttributes[c][n].value[1].value[0].type&&(b.signTime=a.generalizedTimeToDate(b.authenticatedAttributes[c][n].value[1].value[0].value)));k.value.push(b.authenticatedAttributes[c][n]);g=d.md.algorithms[d.pki.oids[b.digestAlgo[c]]].create();g.update(a.toDer(k).bytes());b.verifyResult=!1;try{b.verifyResult=e.verify(g.digest().getBytes(),b.signature[c])}catch(l){b.verifyResult=!1}}else{g=f;var m=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);m.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.contentType).getBytes()));m.value.push(a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.data).getBytes())]));k.value.push(m);m=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[]);m.value.push(a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(d.pki.oids.messageDigest).getBytes()));m.value.push(a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,g)]));k.value.push(m);try{b.verifyResult=e.verify(g,b.signature[c])}catch(p){b.verifyResult=!1}}}},addSign:function(a,b,e){},verify:function(f,c){if("undefined"!=typeof f)if(cert.constructor===Array)for(var e in f)b.certificates.push(f[e]);else b.certificates.push(f);"undefined"!=typeof c&&(b.content=d.util.createBuffer(c,"utf8"));if(b.certificates.length!=b.signContent.length)throw{code:"113042",message:h["113042"]};for(e=0;e<b.certificates.length;e++){var g=b.certificates[e].publicKey,k,n=a.create(a.Class.UNIVERSAL,a.Type.SET,!0,[]);if("undefined"!=typeof b.authenticatedAttributes[0]){for(var l in b.authenticatedAttributes[e])d.pki.oids.messageDigest==a.derToOid(b.authenticatedAttributes[e][l].value[0].value)?k=b.authenticatedAttributes[e][l].value[1].value[0].value:d.pki.oids.signingTime==a.derToOid(b.authenticatedAttributes[e][l].value[0].value)&&(23==b.authenticatedAttributes[e][l].value[1].value[0].type?b.signTime=a.utcTimeToDate(b.authenticatedAttributes[e][l].value[1].value[0].value):24==b.authenticatedAttributes[e][l].value[1].value[0].type&&(b.signTime=a.generalizedTimeToDate(b.authenticatedAttributes[e][l].value[1].value[0].value))),n.value.push(b.authenticatedAttributes[e][l]);var m=d.md.algorithms[d.pki.oids[b.digestAlgo]].create();m.update(b.content.bytes());m.digest().bytes()==k?b.verifyResult=!0:b.verifyResult=!1;n=a.toDer(n).bytes()}else n=b.content.bytes();m=d.md.algorithms[d.pki.oids[b.digestAlgo[e]]].create();m.update(n);b.verifyResult=!1;try{b.verifyResult=g.verify(m.digest().getBytes(),b.signature[e])}catch(p){b.verifyResult=!1}}}}};m.createEncryptedData=function(){var b=null;return b={type:d.pki.oids.encryptedData,version:0,encContent:{algorithm:d.pki.oids["seed-CBC"]},fromAsn1:function(a){if(null==a||"undefined"==typeof a)throw{code:"113032",message:h["113032"]};t(b,a,m.asn1.encryptedDataValidator)},toAsn1:function(){return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.type).getBytes()),a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(b.version)),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,q(b.encContent))])])])},encrypt:function(a,c){if(null==a||"undefined"==typeof a)throw{code:"113033",message:h["113033"]};a=d.util.createBuffer(a);v(b,a,c)},decrypt:function(a){if(null==a||"undefined"==typeof a)throw{code:"113034",message:h["113034"]};a=d.util.createBuffer(a);b.encContent.key=a;u(b)}}};m.createEnvelopedData=function(){var b=null;return b={type:d.pki.oids.envelopedData,version:0,recipients:[],encContent:{algorithm:d.pki.oids["seed-CBC"]},fromAsn1:function(a){if(null==a||"undefined"==typeof a)throw{code:"113035",message:h["113035"]};var c=t(b,a,m.asn1.envelopedDataValidator);a=b;for(var c=c.recipientInfos.value,e=[],d=0;d<c.length;d++)e.push(p(c[d]));a.recipients=e},toAsn1:function(){return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(b.type).getBytes()),a.create(a.Class.CONTEXT_SPECIFIC,0,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,String.fromCharCode(b.version)),a.create(a.Class.UNIVERSAL,a.Type.SET,!0,s(b.recipients)),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,q(b.encContent))])])])},findRecipient:function(a){if(null==a||"undefined"==typeof a)throw{code:"113036",message:h["113036"]};for(var c=a.issuer.attributes,e=0;e<b.recipients.length;++e){var d=b.recipients[e],k=d.issuer;if(d.serialNumber===a.serialNumber&&k.length===c.length){for(var m=!0,l=0;l<c.length;++l)if(k[l].type!==c[l].type||k[l].value!==c[l].value){m=!1;break}if(m)return d}}},decrypt:function(a,c){if(null==a||"undefined"==typeof a)throw{code:"113037",message:h["113037"]};if(null==c||"undefined"==typeof c)throw{code:"113038",message:h["113038"]};if(void 0===b.encContent.key&&void 0!==a&&void 0!==c)switch(a.encContent.algorithm){case d.pki.oids.RSAEncryption:var e=c.decrypt(a.encContent.content);b.encContent.key=d.util.createBuffer(e);break;default:throw{code:"113039",message:h["113039"]+"( OID : "+a.encContent.algorithm+")"};}u(b)},addRecipient:function(a){if(null==a||"undefined"==typeof a)throw{code:"113040",message:h["113040"]};b.recipients.push({version:0,issuer:a.issuer.attributes,serialNumber:a.serialNumber,encContent:{algorithm:d.pki.oids.RSAEncryption,key:a.publicKey}})},encrypt:function(a,c){v(b,a,c);for(var e=0;e<b.recipients.length;e++){var g=b.recipients[e];if(void 0===g.encContent.content)switch(g.encContent.algorithm){case d.pki.oids.RSAEncryption:g.encContent.content=g.encContent.key.encrypt(b.encContent.key.data);break;default:throw{code:"113041",message:h["113041"]};}}}}}}var q="./aes ./seed ./asn1 ./des ./pkcs7asn1 ./pki ./random ./util ./jsustoolkitErrCode".split(" "),r=null;"function"!==typeof define&&("object"===typeof module&&module.exports?r=function(d,h){h(require,module)}:(crosscert=window.crosscert=window.crosscert||{},s(crosscert)));(r||"function"===typeof define)&&(r||define)(["require","module"].concat(q),function(d,h){h.exports=function(a){var h=q.map(function(a){return d(a)}).concat(s);a=a||{};a.defined=a.defined||{};if(a.defined.pkcs7)return a.pkcs7;a.defined.pkcs7=!0;for(var p=0;p<h.length;++p)h[p](a);return a.pkcs7}})})();