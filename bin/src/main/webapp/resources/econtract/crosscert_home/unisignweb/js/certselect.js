var __certselect=function(a){var J=function(g){function t(){if(!a.certsList)return null;var c=null,c=a.certsList,b=c.list.length,f=[],d=g.args.dn,m=null;null!=a.ESVS.Policy&&(-1!=a.ESVS.Policy.indexOf("|")?m=a.ESVS.Policy.split("|"):(m=[],m[0]=a.ESVS.Policy));var e=null;null!=a.ESVS.Organization&&(-1!=a.ESVS.Organization.indexOf("|")?e=a.ESVS.Organization.split("|"):(e=[],e[0]=a.ESVS.Organization));for(var h=0;h<b;h++){a.usWebToolkit.x509Certificate.parser(c.list[h].cert,"Base64");var l=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),q=a.usWebToolkit.x509Certificate.getSubjectName(),K=a.usWebToolkit.x509Certificate.getNotAfter(),k=a.usWebToolkit.x509Certificate.getNotAfter(),u=c.list[h].index,p=a.certUtil().getIssuerName(l);"undefined"==p&&(p=a.certUtil().getO(q));if(null==d||q.toLowerCase()==d.toLowerCase()){if(null!=a.ESVS.Policy){for(var v=0;v<m.length&&m[v]!=l;v++);if(m.length<=v)continue}if(null!=a.ESVS.Organization&&("CERT_RENEWAL"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type)){for(v=0;v<e.length&&e[v].toLowerCase()!=a.certUtil().getO(q).toLowerCase();v++);if(e.length<=v)continue}if(a.ESVS.ShowExpiredCerts||2!==a.certUtil().getExpirationStateValue(k))v=[""],v[1]=a.certUtil().getCertType(l),v[2]=a.certUtil().getCN(q),v[3]=p,v[4]=a.certUtil().getLocalDate(K),v[5]=u,v[6]=a.certUtil().getExpirationStateValue(k),f.push(v)}}return c={list:f}}function n(c,b,f,d,m){if(a.CONST.__USFB_M_DISK.device>c||0>b||!f)return-1;var e=0,g=0;p=b;a.certsList&&(a.certsList=null);if(a.CONST.__PF_M_LS.device===c&&2&a.ESVS.Mode){a.PFSH||m(-1);try{a.PFSH.SelectStorage(1)}catch(l){}try{a.PFSH.LoadAllCerts(document.domain)}catch(q){301E5===q.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}b=null;try{b=a.PFSH.GetUserCerts(document.domain),a.PFUC=b}catch(K){}b&&(e=b.length-1);if(0<e){d=[];for(var k=0;k<e;k++){var u=k+1,n={};n.index=u;n.cert=b[u].signcert;d[k]=n}a.certsList={list:d}}else a.certsList=null,g=0;m(g)}else c==a.CONST.__PF_M_SS.device&&a.CCPFSH()?a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.PKI,function(b,c){0==b&&a.CCPFSH().GetCertificateList(function(b,c){if(0==b){var d=0;(a.PFUC=c)&&(d=c.length-1);if(0<d){for(var f=[],e=0;e<d;e++){var g=e+1,h={};h.index=g;h.cert=c[g].signcert;f[e]=h}a.certsList={list:f}}}m(b)})}):c==a.CONST.__PF_M_CLOUDSIGN.device?(a.uiUtil().loadingBox(!0,"us-div-list-load",0),reqGetCert("01099980198",function(b,c,d){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=b)return m(b),!1;if(0<d.length){c=[];for(var f=0;f<d.length;f++){var e={};e.index=f+1;e.cert=d[f];c[f]=e}a.certsList={list:c}}m(b)})):!a.uiUtil().isItPFDevice(c)&&4&a.ESVS.Mode?a.nimservice()?a.nimservice().GetAllUserCertListNum(c,b,d,function(b,d,g){if(h!=c)return!1;e=g;if(0==b)0<e?a.nimservice().GetAllUserCert(g,function(b,c){0==b?a.certsList={list:c}:win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),b);a.uiUtil().loadingBox(!1,"us-div-list-load");m(b)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),m(0));else{if(c==a.CONST.__USFB_M_MOBILE.device&&61E6==b)return a.ERROR.Code=11003,a.ERROR.Message=f.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(f.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cls-btn").click(),d="firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),null==d&&a.uiUtil().msgBox(f.IDS_MSGBOX_BLOCK_POPUP_WINDOW),a.certsList=null):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),m(0)),!1;if(c==a.CONST.__USFB_M_SECUREDISK.device&&8005E4==b)return a.ERROR.Code=31001,a.ERROR.Message=f.IDS_MSGBOX_NOT_INSTALL_SD,confirm(f.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(d="firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"),null==d&&a.uiUtil().msgBox(f.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),m(b),!1;-1!==e&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());m(b);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),m(-1)):m(g)}function x(c,b){if(!c||!b)return!1;if(!a.certsList||0>l.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var f=a.loadUI("certverify")({type:null,args:{idx:parseInt(l.selectedIndex())},onConfirm:function(){f.dispose();c.focus()},onCancel:function(){f.dispose();c.focus()}});f.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function y(c,b){if(!c||!b)return!1;if(!a.certsList||0>l.selectedIndex())return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var f=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(l.selectedIndex()),cert:a.certsList.list[parseInt(l.selectedIndex())-1].cert},onConfirm:function(){f.dispose();c.focus()},onCancel:function(){f.dispose();c.focus()}});f.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function T(c){if(!c)return!1;var b=document.getElementById("us-div-cert-select");b.style.display="none";var f=a.loadUI("certmanage")({type:"CERT_MANAGEMENT",args:{style:"child"},onCancel:function(){f.dispose();b.style.display="block";c.focus()}});f.show()}function U(c,b,f,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!f||!d)return!1;var m=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(b){0<b&&n(c,b,d,"",function(b){0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),l.redrawList(null,0)):(b=t())?l.redrawList(b.list,b.list.length):l.redrawList(null,0);a.ESVS.Embedded?setTimeout(function(){m.dispose()},10):m.dispose();f.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");m.dispose();f.focus()}});m.show()}function V(c,b,f,d){if(a.CONST.__USFB_M_DISK.device>c||!f||!d)return!1;var m=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(e){var h=b.list[e-1].name;if(!1==a.ESVS.IssueCertInBIOToken&&("CERT_RENEWAL_KMCERT"===g.type||"CERT_RENEWAL"===g.type||"CERT_RENEWAL_SIGN"===g.type||"CERT_REVOCATION"===g.type||"CERT_SOE"===g.type)&&c==a.CONST.__USFB_M_HSMKEY.device&&-1!=h.indexOf("BIO_"))return a.uiUtil().errMsgBox(d.IDS_CANT_ISSUECERT_BIOTOKEN,-1),!1;0<e&&(a.ESVS.Embedded?setTimeout(function(){m.dispose()},10):m.dispose(),n(c,e,d,"",function(b){if(0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(d.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}l.redrawList(null,0)}else(b=t())?l.redrawList(b.list,b.list.length):l.redrawList(null,0);f.focus()}))},onCancel:function(){m.dispose();f.focus()}});m.show()}function W(c,b,f,d){if(a.CONST.__USFB_M_DISK.device>c||!b||!f||!d)return!1;var m=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){m.dispose();a.nimservice()?a.nimservice().CheckSCardConnected(function(b,e){0===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();a.nimservice().CheckSCardPin(b,function(e,m){if(0!=e){switch(e){case 4904E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,e)}l.redrawList(null,0);setTimeout(function(){f.focus()},10)}else n(c,0,d,b,function(b){0!=b?(a.uiUtil().errMsgBox(d.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),l.redrawList(null,0)):(b=t())?l.redrawList(b.list,b.list.length):l.redrawList(null,0);setTimeout(function(){f.focus()},10)})})},onCancel:function(){PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){f.focus()},10)}}),PINDialog.show()):(a.uiUtil().msgBox(d.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){f.focus()},10))}):(a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){f.focus()},10))},onCancel:function(){m.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");f.focus()}});m.show()}function X(c,b){if(!c||!b)return!1;h=a.CONST.__PF_M_SS.device;p=0;displayFunctionButton(h);a.certsList&&(a.certsList=null);l.redrawList(null,-1);n(a.CONST.__PF_M_SS.device,0,b,"",function(c){if(0!=errCode)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,errCode),l.redrawList(null,0),!1;(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)})}function C(c,b){if(!c||!b)return!1;h=a.CONST.__PF_M_LS.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();n(a.CONST.__PF_M_LS.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),l.redrawList(null,0),!1;(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)})}function J(c,b){if(!c||!b)return!1;h=a.CONST.__PF_M_CLOUDSIGN.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();n(a.CONST.__PF_M_CLOUDSIGN.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),l.redrawList(null,0),!1;(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)})}function Y(c,b){if(!c||!b)return!1;h=a.CONST.__USFB_M_HDD.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();n(a.CONST.__USFB_M_HDD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),l.redrawList(null,0),!1;(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0);return!0})}function Z(c,b){if(!c||!b)return!1;var f=null;h=a.CONST.__USFB_M_DISK.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h))if(a.nimservice())a.nimservice().GetDiskList(function(d,m,e){m=0;e&&(m=e.length);if(0==d&&0<m){d=[];for(var g=0;g<m;g++){var h={};h.index=g+1;h.name=e[g];d[g]=h}f={list:d}}else return a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,!1;U(a.CONST.__USFB_M_DISK.device,f,c,b)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function $(c,b){if(!c||!b)return!1;var f=null;h=a.CONST.__USFB_M_HSMKEY.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);aa(b);w();if(4&a.ESVS.Mode)if(a.nimservice()){var d=0;if("CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type)d=1;a.nimservice().GetHSMList(d,function(d,e,g){e=0;g&&(e=g.length);if(0==d&&0<e){d=0;for(var h=[],l=0;l<e;l++){var p=l+1,k={},u=g[l].split("|");k.index=p;k.name=u[0];k.driver=u[1];k.passage=u[2];k.validity=u[3];h[d++]=k}f={list:h}}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.nimservice().GetLastErrorCode();V(a.CONST.__USFB_M_HSMKEY.device,f,c,b)})}else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ba(c,b){if(!c||!b)return!1;h=a.CONST.__USFB_M_SECUREDISK.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();a.nimservice().IsSDInstalled(function(c,d){a.uiUtil().loadingBox(!1,"us-div-list-load");0!=c?(a.ERROR.Code=31001,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SD,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW))):n(a.CONST.__USFB_M_SECUREDISK.device,1,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),l.redrawList(null,0),!1;(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0);return!0})})}function L(c,b){if(!c||!b)return!1;h=a.CONST.__USFB_M_MOBILETOKEN.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().IsInstalledUSIMModule(2,!1,function(c,d){a.uiUtil().loadingBox(!1,"us-div-list-load");0==c?a.nimservice().SetUSIMOptions(a.usimEnv.sitecode,a.usimEnv.modecode,a.usimEnv.siteURL,a.usimEnv.serviceIP,a.usimEnv.servicePort,a.usimEnv.downloadURL,function(a){document.getElementById("us-confirm-btn").click()}):4847E4==c?(a.ERROR.Code=21002,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SMARTCERT)?(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):(l.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display="")):(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),l.redrawList(null,-1),document.getElementById("us-div-cert-select").style.display="")});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function ca(c,b){if(!c||!b)return!1;var f=[function(){L(c,b)},function(){da(c,b)}],d=a.loadUI("mobileselect")({type:null,args:null,onConfirm:function(a){f[a]();d.dispose()},onCancel:function(){d.dispose()}});d.show();return!0}function da(c,b){if(!c||!b)return!1;h=a.CONST.__USFB_M_MOBILE.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h))if(a.nimservice())n(h,p,b,"",function(c){if(0!=c){switch(c){case 61E6:case 6101E4:a.ERROR.Code=11003;a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_MOBILE;confirm(b.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)&&(document.getElementById("us-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW));break;case 6102E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_LOAD_LIBRARY,c);break;case 6107E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_SET_ENV,c)}l.redrawList(null,0)}else(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)});else return a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;return!0}function D(c,b){if(!c||!b)return!1;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function A(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=G.IDS_PASSWORD_DESCRIPTION;return!0}function aa(a){if(!a)return!1;var b=document.getElementById("us-lbl-pw");b.removeChild(b.lastChild);b.appendChild(document.createTextNode(a.IDS_PIN));document.getElementById("us-lbl-pw2").innerHTML="";return!0}function w(){var a=document.getElementById("us-pw-text");a&&(a.value="",a.readOnly=!1,a.disabled=!1)}function ea(c,b,f){if(!c||!b||!f)return!1;var d=0,g={};try{var e=a.PFSH.SetP12OnMemory(c,b),d=e.index;a.PFUC=g=e.aluc}catch(h){switch(h.code){case 1E7:0<=h.detail.indexOf("115010")?a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,h.detail);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,h.code)}return!1}a.certsList&&(a.certsList=null);c=[];f={};e=null;f.index=d;f.cert=g[d].signcert;c[0]=f;a.certsList={list:c};if(e=t())return l.redrawList(e.list,e.list.length),null==b||0>=b.length||(d=document.getElementById("us-pw-text"),d.value=b,d.readOnly=!0,d.disabled=!0),!0;a.certsList=null;l.redrawList(null,-1);w();return!1}function E(){a.certsList&&(a.certsList=null);l.redrawList(null,-1);w();pw=""}function M(c,b,f,d){(null==b||0>=b.length||null==f)&&d(-1);a.certsList&&(a.certsList=null);if(0<c)a.nimservice().GetSignCertFromCertList(c,function(e,f,g){f=[];var m={},h=null;0==e?(m.index=c,m.cert=g,f[0]=m,a.certsList={list:f},(h=t())?(l.redrawList(h.list,h.list.length),b="",d(0)):(E(),d(-1))):(E(),d(-1))});else{var g=a.nimservice().GetLastErrorCode();a.nimservice().GetLastErrorMessage();switch(g){case 4301E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_COMMON_ERROR_GET_CERT,g)}E();d(-1)}}function fa(c,b,f,d){(null==c||0>=c.length||null==b||0>=b.length||null==f)&&d(-1);a.nimservice()?a.nimservice().GetPfxCertList(1,c,b,function(c,e,g){0==c?M(g,b,f,function(c){0==c?d(0):d(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(e,c),E(),d(0),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),b="",d(-1))}function ga(c,b,f,d){(null==c||0>=c.length||null==b||0>=b.length||null==f)&&d(-1);4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h)?a.nimservice()?a.nimservice().GetPfxCertList(0,c,b,function(c,e,g){0==c?M(g,b,f,function(c){0==c?d(0):d(-1);b="";a.uiUtil().loadingBox(!1,"us-div-list-load")}):(a.uiUtil().errMsgBox(e,c),E(),d(-1),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):(a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),d(-1)):(rv=ea(c,b,f),b="")}function N(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){var f=c.split("."),f=f[f.length-1].toLowerCase();if("pfx"!=f&&"p12"!=f)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function ha(c,b){if(!c||!b)return!1;h=a.CONST.__USFB_M_ETC.device;p=0;var f=null,d=null,g=document.getElementById("us-confirm-btn"),e=document.getElementById("us-cert-search-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader){var l=c.files;if(0<l.length){var n=l[0];if(!0==N(n.name,b)){var q=new FileReader;q.readAsBinaryString?(q.readAsBinaryString(n),q.addEventListener("load",function(){var c=q.result,e=c.length;if(n.size===e)d=a.usWebToolkit.util.encode64(c,e);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1})):(q.readAsArrayBuffer(n),q.addEventListener("load",function(){var c=q.result,e=null;try{var f=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(c)));try{e=decodeURIComponent(escape(f))}catch(g){if("URIError"==g.name)e=f;else throw g;}}catch(h){return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}c=e.length;if(n.size===c)d=a.usWebToolkit.util.encode64(e,c);else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){e.focus()},10),!1}else return setTimeout(function(){e.focus()},10),!1}else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))l=document.getElementById("us-div-cert-select"),l.onselectstart=function(){return!0},c.select(),f=c.value,c.style.display="none",l.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(f=c.value,-1<f.indexOf("fakepath"))return a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){e.focus()},10),!1}else f=c.value;if(!1==N(f,b))return setTimeout(function(){e.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(a){null!=f?fa(f,a,b,function(b){a="";Dialog.dispose();0===b?setTimeout(function(){g.focus()},10):setTimeout(function(){e.focus()},10)}):ga(d,a,b,function(b){a="";Dialog.dispose();0===b?setTimeout(function(){g.focus()},10):setTimeout(function(){e.focus()},10)})},onCancel:function(){Dialog.dispose();setTimeout(function(){e.focus()},10)}});Dialog.show()}function ia(a){if(!a)return!1;a=a||window.event;13==(a.which||a.keyCode)&&document.getElementById("us-confirm-btn").click();return!0}function s(){g.onConfirm=O;H=!1}function ja(c){function b(){P++;P>=a.ESVS.LimitNumOfTimesToTryToInputPW?a.ESVS.Embedded?(a.bsUtil().AhnlabClearText("us-pw-text"),m.value="",setTimeout(function(){m.focus()},10)):(a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_BEFORE+a.ESVS.LimitNumOfTimesToTryToInputPW+d.IDS_MSGBOX_PW_ERROR_OVER_NUMBER_OF_ALLOWED_AFTER),I()):(a.bsUtil().AhnlabClearText("us-pw-text"),m.value="",setTimeout(function(){m.focus()},10))}l.restoreOnMouseEvent();if(!c)return!1;var f=g.onConfirm;if(!1==H)O=g.onConfirm,H=!0;else return!1;g.onConfirm=function(){};var d=c,m=document.getElementById("us-pw-text"),e=m.value;if(h==a.CONST.__USFB_M_ETC.device&&("CERT_RENEWAL_KMCERT"===g.type||"CERT_RENEWAL"===g.type||"CERT_RENEWAL_SIGN"===g.type||"CERT_REVOCATION"===g.type||"CERT_SOE"===g.type))return a.uiUtil().errMsgBox(d.IDS_CANT_WORK_WITH_PFX,-1),s(),!1;e&&4&a.ESVS.Mode&&("touchen"==a.ESVS.SecureKeyboardType&&a.bsUtil().isTouchEnKeyUsable()?e=a.bsUtil().GetEncryptPwd("us-keyboard-secure-frm","us-pw-text"):"ahnlab"==a.ESVS.SecureKeyboardType&&a.bsUtil().isAhnlabProtectorUsable()&&(e=a.bsUtil().GetAhnlabEncInputInfo("us-pw-text")));if(a.CONST.__USFB_M_MOBILETOKEN.device!=h&&(!a.certsList||0>l.selectedIndex()))return a.uiUtil().msgBox(d.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),m.value="",setTimeout(function(){m.focus()},10),s(),!1;if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(h)){if(!a.nimservice())return s(),!1;var n=function(){var b=parseInt(l.selectedIndex());if("DIGITAL_SIGNATURE_P7"===g.type){var k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;var u=a.certUtil().getTheCertAttributes(k,"Base64");f(d.IDS_MSGBOX_SIGN_ERROR,k,u,b,e,h)}else if("DIGITAL_SIGNATURE_P7_EXT"===g.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==g.type)f(d.IDS_MSGBOX_SIGN_ERROR,b,e,h,p);else if("DIGITAL_SIGNATURE_P7_XML"===g.type){k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;u=a.certUtil().getTheCertAttributes(k,"Base64");f(d.IDS_MSGBOX_SIGN_ERROR,u,b,e,h,k)}else if("DIGITAL_SIGNATURE_P1"===g.type){k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(k,"Base64");u=a.usWebToolkit.x509Certificate.getSubjectName();if(!u||0>=u.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-2),s(),!1;f(k,u,d.IDS_MSGBOX_SIGN_ERROR,b,e,h)}else if("CERT_RENEWAL"==g.type||"CERT_RENEWAL_KMCERT"==g.type){k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(k,"Base64");var n=a.usWebToolkit.x509Certificate.getNotAfter();if(!n||0>=n.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),s(),!1;"CERT_RENEWAL"==g.type?f(n,c.IDS_CONFIRMBOX_CERT_RENEWAL,h,p,b,e):f(n,c.IDS_CONFIRMBOX_KMCERT_ISSUE,h,p,b,e)}else if("CERT_REVOCATION"==g.type)f(d.IDS_CONFIRMBOX_CERT_REVOCATION,b,e,h,p);else if("CERT_SOE"==g.type)f(d.IDS_CONFIRMBOX_CERT_SOE,b,e,h,p);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==g.type){n={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;u=a.certUtil().getTheCertAttributes(k,"Base64");f(b,e,n,k,u,h);m.value=""}else if("DIGITAL_SIGNATURE_P7_FILE"===g.type){k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;u=a.certUtil().getTheCertAttributes(k,"Base64");f(b,e,d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,u,h)}else if("ENCRYPT_P7"==g.type)f(b,e,d.IDS_MSGBOX_ENCRYPT_ERROR);else if("VID_VERIFICATION"===g.type)f(b,e,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM");else if("CERT_RENEWAL_SIGN"==g.type){k=a.certsList.list[b-1].cert;if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(k,"Base64");n=a.usWebToolkit.x509Certificate.getNotAfter();if(!n||0>=n.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),s(),!1;u=a.certUtil().getTheCertAttributes(k,"Base64");f(n,c.IDS_CONFIRMBOX_CERT_RENEWAL,h,p,b,e,u)}else f()};if(a.CONST.__USFB_M_MOBILETOKEN.device==h){if("DIGITAL_SIGNATURE_P7"===g.type)f(d.IDS_MSGBOX_SIGN_ERROR,null,null,-1,"",h);else if("DIGITAL_SIGNATURE_P7_EXT"===g.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==g.type)f(d.IDS_MSGBOX_SIGN_ERROR,-1,"",h,p);else if("DIGITAL_SIGNATURE_P1"===g.type)f(null,"",d.IDS_MSGBOX_SIGN_ERROR,-1,"",h);else if("CERT_RENEWAL"==g.type)f("",c.IDS_CONFIRMBOX_CERT_RENEWAL,h,p,-1,"");else if("CERT_RENEWAL_KMCERT"==g.type)f("",c.IDS_CONFIRMBOX_KMCERT_ISSUE,h,p,-1,"");else if("CERT_RENEWAL_SIGN"==g.type)f("",c.IDS_CONFIRMBOX_CERT_RENEWAL,h,p,-1,"",null);else if("CERT_REVOCATION"==g.type)f(d.IDS_CONFIRMBOX_CERT_REVOCATION,-1,"",h,p);else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"===g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"===g.type){var r={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};f(-1,"",r,null,null,h)}else"DIGITAL_SIGNATURE_P7_FILE"===g.type?f(-1,"",d.IDS_MSGBOX_SIGN_ERROR,d.IDS_CONFIRMBOX_FILE_ALREADY_EXIT,null,h):"ENCRYPT_P7"==g.type?f(-1,e,d.IDS_MSGBOX_ENCRYPT_ERROR):"VID_VERIFICATION"===g.type?f(-1,"",d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"NIM"):"DIGITAL_SIGNATURE_P7_XML"===g.type?f(d.IDS_MSGBOX_SIGN_ERROR,null,-1,"",h,null):"CERT_SOE"==g.type?f(d.IDS_CONFIRMBOX_CERT_SOE,-1,"",h,p):"ENCRYPT_P7"==g.type?f(-1,"",d.IDS_MSGBOX_ENCRYPT_ERROR):f();m.value="";a.ESVS.Embedded&&w();return!0}var q=parseInt(l.selectedIndex());if("MPKI"==a.ESVS.PKI||h==a.CONST.__USFB_M_ETC.device||h==a.CONST.__USFB_M_HSMKEY.device||"CERT_RENEWAL"!=g.type&&"CERT_RENEWAL_SIGN"!=g.type&&"CERT_RENEWAL_KMCERT"!=g.type&&"CERT_REVOCATION"!==g.type&&"CERT_SOE"!==g.type&&"DIGITAL_SIGNATURE_P1"!==g.type&&"DIGITAL_SIGNATURE_P7"!==g.type&&"DIGITAL_SIGNATURE_P7_EXT"!=g.type&&"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"!=g.type&&"DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"!==g.type&&"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"!==g.type&&"VID_VERIFICATION"!==g.type)return n(),m.value="",a.ESVS.Embedded&&w(),!0;if(!e||0>=e.length)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){m.focus()},10),s(),!1;a.nimservice().CheckPassword(h,p,q,e,function(c,e){if(0==c)return n(),m.value="",a.ESVS.Embedded&&w(),!0;s();"Enabled"===a.ESVS.UniCRS?a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED_URS,c):a.uiUtil().errMsgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED,c);b();a.uiUtil().loadingBox(!1,"us-div-list-load")})}else if(2&a.ESVS.Mode&&a.uiUtil().isItPFDevice(h)){if(!e)return a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){m.focus()},10),s(),!1;if(h==a.CONST.__PF_M_CLOUDSIGN.device)k=!0;else{if(!a.PFUC)return s(),!1;q=parseInt(l.selectedIndex());r=null;try{r=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[q].signpri)}catch(t){}var k=!1;try{k=a.usWebToolkit.pkcs8.checkUserCertPassword(r,e)}catch(u){}finally{r=""}}if(!1===k)a.uiUtil().msgBox(d.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED),b();else{k=null;h==a.CONST.__PF_M_CLOUDSIGN.device?(q=parseInt(l.selectedIndex()),k=a.certsList.list[q-1].cert):k=a.PFUC[q].signcert;if("DIGITAL_SIGNATURE_P7"===g.type){if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;var B=a.certUtil().getTheCertAttributes(k,"Base64");f(d.IDS_MSGBOX_SIGN_ERROR,k,B,q,e,h)}else if("DIGITAL_SIGNATURE_P1"===g.type){if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;B=a.certUtil().getTheCertAttributes(k,"Base64");f(k,B.subjectName,d.IDS_MSGBOX_SIGN_ERROR,q,e,h)}else if("DIGITAL_SIGNATURE_P7_AND_VID_VERIFICATION"==g.type||"DIGITAL_SIGNATURE_P1_AND_VID_VERIFICATION"==g.type){r={signErr:d.IDS_MSGBOX_SIGN_ERROR,verifySuc:d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,verifyErr:d.IDS_MSGBOX_VID_ERROR_VERIFICATION};if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_SIGN_ERROR,-1),s(),!1;B=a.certUtil().getTheCertAttributes(k,"Base64");f(q,e,r,k,B,h)}else if("CERT_RENEWAL"==g.type){if(!k||0>=k.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-1),s(),!1;a.usWebToolkit.x509Certificate.parser(k,"Base64");r=a.usWebToolkit.x509Certificate.getNotAfter();if(!r||0>=r.length)return a.uiUtil().errMsgBox(d.IDS_MSGBOX_RENEW_ERROR,-2),s(),!1;f(r,d.IDS_CONFIRMBOX_CERT_RENEWAL,h,p,q,e)}else"CERT_REVOCATION"===g.type?f(d.IDS_CONFIRMBOX_CERT_REVOCATION,q,e,h,p):"VID_VERIFICATION"===g.type?f(q,e,d.IDS_MSGBOX_VID_SUCCESS_VERIFICATION,d.IDS_MSGBOX_VID_ERROR_VERIFICATION,"PFS"):f();m.value="";a.ESVS.Embedded&&w();return!0}}return!1}function ka(c,b,f){if(!c||!b)return!1;Q=a.loadUI("gridlist");l=Q({type:"certslist",tblid:"us-tbl-list",tbltitleid:"us-tbl-list-th",titlelistid:"us-grid-head-div",titlerowid:"us-list-title-row",titleelementid:"us-list-title-element",titledividerid:"us-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-tbl-list-td",datalistid:"us-grid-body-div",datarowid:"us-list-body-row",dataelementid:"us-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element"});f=!0;"opera"==a.browserName&&(f=!1);l.drawList(c,c.length,null,0,R,f);n(h,p,b,"",function(c){0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=t())?l.redrawList(c.list,c.list.length):l.redrawList(null,0)})}function z(c){if(!c)return!1;F(c,G,"close");for(var b=a.ESVS.Media.list.split("|"),f=0;f<b.length;f++){var d=a.CONST.medias[b[f]];void 0!=d&&null!=d&&(d=document.getElementById("us-btn-"+d.name),void 0!=d&&null!=d&&"us-layout-storage-btn-none"!=d.className&&(d.className=c===d?"us-layout-storage-btn-on":"us-layout-storage-btn-off"))}return!0}function la(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);!1==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;var b=document.getElementById("us-storage-btn-list"),f=document.createElement("li");f.setAttribute("id","us-storage-btn-li-"+c.name,0);f.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(f.className="line-first");"hidden"===c.visibility?(f.style.display="none",f.style.visibility="hidden"):(f.style.display="block",f.style.visibility="visible");var d=document.createElement("button");d.setAttribute("type","button",0);d.setAttribute("id","us-btn-"+c.name,0);d.setAttribute("title",c.label,0);d.setAttribute("tabindex",c.tabIndex,0);c.disabled?(d.onclick=function(){a.uiUtil().msgBox(G.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},d.className="us-layout-storage-btn-none"):(d.onclick=c.onclick,d.className=c.device===h?"us-layout-storage-btn-on":"us-layout-storage-btn-off");f.appendChild(d);if("harddisk"!==c.name&&"webstorage"!==c.name){var g=document.createElement("span");g.className="us-drive-select";d.appendChild(g)}g=document.createElement("span");g.className="us-img-storage";var e=document.createElement("img");e.setAttribute("id","us-img-"+c.name,0);e.setAttribute("alt",c.label,0);c.disabled?e.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):e.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);g.appendChild(e);d.appendChild(g);g=document.createElement("span");g.setAttribute("id","us-lbl-"+c.name,0);g.className="us-layout-lbl-storage";g.appendChild(document.createTextNode(c.label));d.appendChild(g);f.appendChild(d);b.appendChild(f);return!0}function F(c,b,f){if("no_more"==f)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{if(c=document.getElementById("us-storage-wrap"))"open"==f?(c.className="us-layout-storage-more-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){F(this,b,"close")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c.className="us-layout-storage-wrap",c=document.getElementById("us-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){F(this,b,"open")},c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var d=0;d<c.length;d++){var g=a.CONST.medias[c[d]];if(void 0!=g&&null!=g){var e=document.getElementById("us-storage-btn-li-"+g.name);if(void 0!=e&&null!=e){var h=e.getAttribute("mediaIndex");"open"==f?(e.style.display="block",e.style.visibility="visible"):6<h?(e.style.display="none",e.style.visibility="hidden"):(e.style.display="block",e.style.visibility="visible");1==h&&document.getElementById("us-btn-"+g.name)}}}}return!0}function I(){l.restoreOnMouseEvent();g.onCancel()}var ma=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+(a.ESVS.Embedded?"unisignweb/rsrc/layout/certselect_embedded.html?version="+a.ver:"unisignweb/rsrc/layout/certselect.html?version="+a.ver),!1);c.send(null);return c.responseText},S=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certselect_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},G=eval(eval(S)()),Q=null,l=null,P=0,r=a.ESVS.TabIndex,R=0,h=a.CONST.__USFB_M_HDD.device,p=0;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){if(h=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice),h==a.CONST.__USFB_M_SECUREDISK.device||h==a.CONST.__USFB_M_SMARTCARD.device||h==a.CONST.__USFB_M_DISK.device)p=1}else 2==a.ESVS.Mode&&(h=a.CONST.__PF_M_LS.device);var H=!1,O=null;return function(){var c=eval(ma),b=eval(eval(S)());a.ESVS.TargetObj.innerHTML=c();g.args.device&&a.uiUtil().isValidDevice(g.args.device)&&(h=g.args.device,p=g.args.drive);var f=document.getElementById("us-lbl-title");a.ESVS.Embedded?(c=document.getElementById("us-lbl-title"),c.appendChild(document.createTextNode(b.IDS_CERT_SELECTION+" "+b.IDS_CERT_SELECTION_PURPOSE_SIGN)),c.setAttribute("tabindex",r++,0),c=document.getElementById("us-cursor-disabled"),c.setAttribute("tabindex",r++,0)):(f.appendChild(document.createTextNode(b.IDS_CERT_SELECTION)),f.setAttribute("tabindex",r++,0),c=document.getElementById("us-cls-img-btn"),c.setAttribute("title",b.IDS_CLOSE_CERT_SELECTION_CLOSE,0),c.onclick=function(){I()},document.getElementById("us-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0),c=document.getElementById("us-cursor-disabled"),c.setAttribute("title",b.IDS_SENSE_READER_INTRO,0),c=document.getElementById("us-logo-img"),c.setAttribute("alt",b.IDS_LOGO,0),null!=a.options.logo?c.setAttribute("src",a.options.logo,0):c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0),c=document.getElementById("us-legend-storage"),c.appendChild(document.createTextNode(b.IDS_STORAGE_SELECT)));for(var c=0,d=a.ESVS.Media.list.split("|"),m=0;m<d.length;m++){var e=a.CONST.medias[d[m]];if(void 0!=e&&null!=e){switch(e.device){case a.CONST.__USFB_M_DISK.device:e.label=b.IDS_STORAGE_REMOVABLE;e.disabled=2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;e.onclick=function(){Z(this,b);z(this)};break;case a.CONST.__USFB_M_HSMKEY.device:e.label=b.IDS_STORAGE_SECTOKEN;e.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;e.onclick=function(){$(this,b);z(this)};break;case a.CONST.__USFB_M_SMARTCARD.device:e.label=b.IDS_STORAGE_SAVETOKEN;e.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;e.onclick=function(){if(this&&b){var c=null;h=a.CONST.__USFB_M_SMARTCARD.device;p=0;a.certsList&&(a.certsList=null);l.redrawList(null,-1);A(b);w();var c=[],d={};d.index=a.CONST.__USFB_M_SMARTCARD.device;d.name=b.IDS_SAVETOKEN_SMART_CARD;c[0]=d;c={list:c};W(a.CONST.__USFB_M_SMARTCARD.device,c,this,b)}z(this)};break;case a.CONST.__USFB_M_MOBILE.device:e.label=b.IDS_STORAGE_MOBILEPHONE;e.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||g.type&&("CERT_RENEWAL"==g.type||"CERT_RENEWAL_SIGN"==g.type||"CERT_RENEWAL_KMCERT"==g.type||"CERT_REVOCATION"==g.type||"CERT_SOE"==g.type);e.onclick=function(){ca(this,b);z(this)};break;case a.CONST.__USFB_M_HDD.device:e.label=b.IDS_STORAGE_HARDDISK;e.disabled=2==a.ESVS.Mode;e.onclick=function(){Y(this,b);z(this)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:e.label=b.IDS_STORAGE_MOBILETOKEN;e.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI||g.type&&("DIGITAL_SIGNATURE_P7_EXT"==g.type||"DIGITAL_SIGNATURE_P7_EXT_DISABLE_SECTOKEN"==g.type);e.onclick=function(){document.getElementById("us-div-cert-select").style.display="none";L(this,b);z(this)};break;case a.CONST.__USFB_M_SECUREDISK.device:e.label=b.IDS_STORAGE_SECUREDISK;e.disabled="win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI;e.onclick=function(){ba(this,b);z(this)};break;case a.CONST.__PF_M_LS.device:e.label=b.IDS_STORAGE_LS;e.disabled=1==a.ESVS.Mode;e.onclick=function(){C(this,b);z(this)};break;case a.CONST.__PF_M_SS.device:e.label=b.IDS_STORAGE_SS;e.disabled=1==a.ESVS.Mode;e.onclick=function(){X(this,b);z(this)};break;case a.CONST.__PF_M_TOUCHSIGN.device:e.label=b.IDS_STORAGE_TOUCHSIGN;e.disabled=!0;e.onclick=function(){D(this,b)};break;case a.CONST.__PF_M_SMARTSIGN.device:e.label=b.IDS_STORAGE_SMARTSIGN;e.disabled=!0;e.onclick=function(){D(this,b)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:e.label=b.IDS_STORAGE_WEBSECTOKEN;e.disabled=!0;e.onclick=function(){D(this,b)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:e.label=b.IDS_STORAGE_WEBSOFTTOKEN;e.disabled=!0;e.onclick=function(){D(this,b)};break;case a.CONST.__PF_M_CLOUDSIGN.device:e.label=b.IDS_STORAGE_CLOUDSIGN;e.disabled=1==a.ESVS.Mode;e.onclick=function(){J(this,b);z(this)};break;default:e.label=b.IDS_STORAGE_ETC,e.disabled=!0,e.onclick=function(){D(this,b)}}e.tabIndex=r;e.mediaIndex=c+1;e.visibility=6<e.mediaIndex?"hidden":"visible";la(e)&&(r++,c++)}}d=document.getElementById("us-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",r++,0),d.onclick=function(){F(this,b,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){F(this,b,"no_more")}),c=document.getElementById("us-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-tbl-list").style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-tbl-list-caption").appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var n=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];R=r++;setTimeout(function(){ka(n,b,g.args.list)},100);document.getElementById("us-lbl-pw").appendChild(document.createTextNode(b.IDS_PASSWORD));document.getElementById("us-lbl-pw2").innerHTML=b.IDS_PASSWORD_DESCRIPTION;document.getElementById("us-file-search-hidden").onchange=function(){ha(this,b)};c=document.getElementById("us-cert-search-btn");c.setAttribute("value",b.IDS_CERT_SEARCH,0);c.setAttribute("title",b.IDS_CERT_SEARCH+b.IDS_BUTTON,0);c.onclick=function(){if(null!=b){var c=document.getElementById("us-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))a.uiUtil().msgBox(b.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI);else{if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))c.style.display="block";c.value="";if(""!=c.value){var d=c.onchange,e=c.parentNode;e.removeChild(c);c=document.createElement("input");c.setAttribute("type","file",0);c.setAttribute("accept","application/x-pkcs12",0);c.setAttribute("id","us-file-search-hidden",0);c.className="us-layout-file-search-hidden";c.onchange=d;e.appendChild(c)}c.click()}}};a.uiUtil().addCapsLockEvent("us-pw-text","us-err-msg-capslock",b.IDS_MSGBOX_CAPSLOCK_ON,ia);d=document.getElementById("us-pw-text");d.value="";a.ESVS.Embedded||(document.getElementById("enabledpw").innerHTML='<input id="us-confirm-btn" class="us-normal-btn btn-confirm h35" type="button" />');"MPKI"==a.ESVS.PKI&&(m=document.getElementById("us-lbl-pw"),e=document.getElementById("us-lbl-pw2"),m.disabled=!0,e.disabled=!0,d.readOnly=!0,d.disabled=!0);m=document.getElementById("us-confirm-btn");m.setAttribute("value",b.IDS_CONFIRM,0);m.setAttribute("title",b.IDS_CONFIRM+b.IDS_BUTTON,0);m.onclick=function(){ja(b)};var s=document.getElementById("us-cert-verify-btn");s&&(s.setAttribute("value",b.IDS_CERT_VERIFY,0),s.setAttribute("title",b.IDS_CERT_VERIFY+b.IDS_BUTTON,0),s.onclick=function(){x(this,b)});e=document.getElementById("us-cert-view-btn");e.setAttribute("value",b.IDS_CERT_VIEW,0);e.setAttribute("title",b.IDS_CERT_VIEW+b.IDS_BUTTON,0);e.onclick=function(){y(this,b)};var q=document.getElementById("us-cert-proposal-btn");q.setAttribute("value",b.IDS_CERT_PROPOSAL,0);q.setAttribute("title",b.IDS_CERT_PROPOSAL+b.IDS_BUTTON,0);q.onclick=function(){this&&("firefox"==a.browserName?window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?","crosscert_url","scrollbars=1"):window.open("https://raadmin.crosscert.com/customer/tk/Main.jsp?"),this.focus())};if(0==a.ESVS.CertRequestPageEnable||"MPKI"==a.ESVS.PKI)q.readOnly=!0,q.disabled=!0;var t=document.getElementById("us-cert-manage-btn");t&&(t.setAttribute("value",b.IDS_CERT_MANAGE,0),t.setAttribute("title",b.IDS_CERT_MANAGE+b.IDS_BUTTON,0),t.onclick=function(){T(this)},"MPKI"==a.ESVS.PKI?(t.display="block",t.visibility="visible",t.setAttribute("tabindex",r++,0)):(t.style.display="none",t.style.visibility="hidden"));if(a.ESVS.Embedded)d.setAttribute("tabindex",r++,0),m.setAttribute("tabindex",r++,0),c.setAttribute("tabindex",r++,0),q.setAttribute("tabindex",r++,0),e.setAttribute("tabindex",r++,0),s&&s.setAttribute("tabindex",r++,0);else{d.setAttribute("tabindex",r++,0);"none"!=document.getElementById("us-div-cert").style.display&&m.setAttribute("tabindex",r++,0);c.setAttribute("tabindex",r++,0);q.setAttribute("tabindex",r++,0);e.setAttribute("tabindex",r++,0);s&&s.setAttribute("tabindex",r++,0);"none"==document.getElementById("us-div-cert").style.display&&m.setAttribute("tabindex",r++,0);var k=document.getElementById("us-cls-btn");k.setAttribute("value",b.IDS_CLOSE,0);k.setAttribute("title",b.IDS_CLOSE+b.IDS_BUTTON,0);k.setAttribute("tabindex",r++,0);k.onclick=function(){I()};k.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(k.onblur=function(){setTimeout(function(){s.focus()},10)});9!=b||a.shiftKey||(k.onblur=function(){setTimeout(function(){f.focus()},10)})};f.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(f.onblur=function(){setTimeout(function(){k.focus()},10)});if(9==b&&!a.shiftKey){var c=document.getElementById("us-btn-mobiletoken");f.onblur=function(){setTimeout(function(){c.focus()},10)}}};c=document.getElementById("us-lbl-notice");c.appendChild(document.createTextNode(b.IDS_NOTICE));"MPKI"==a.ESVS.PKI&&(c.style.visibility="hidden")}null!=a.options.popup&&(document.getElementById("us-div-cert-select").className=document.getElementById("us-div-cert-select").className+" popup");return document.getElementById("us-div-cert-select")}()};return function(g){function t(){function g(){0<n.value.length?n.value="":(5>t&&setTimeout(g,10),t++)}var n=document.getElementById("us-pw-text"),t=0;g();for(var x=a.ESVS.Media.list.split("|"),y=0;y<x.length;y++){var C=a.CONST.medias[x[y]];if(void 0!=C&&null!=C&&"us-layout-storage-btn-on"==document.getElementById("us-btn-"+C.name).className){a.bsUtil().SetSecurityStatus("us-pw-text");a.bsUtil().SetReScan();break}}}var n=J({type:g.type,args:g.args,onConfirm:g.onConfirm,onCancel:g.onCancel});if(!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))){g=a.uiLayerLevel;var x=a.uiUtil().getOverlay(g);n.style.zIndex=g+1;document.body.insertBefore(x,document.body.firstChild)}var y=window.onresize;return{show:function(){a.ActiveUI=this;a.ESVS.Embedded?(n.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(n,"width","width")))/2+"px",n.style.display="block"):null==a.options.popup?(draggable(n,document.getElementById("us-div-title")),x.style.display="block",a.uiUtil().offsetResize(n)):(-1<a.options.popup.indexOf("move=true")?draggable(n,document.getElementById("us-div-title")):document.getElementById("us-div-title").style.cursor="default",-1<a.options.popup.indexOf("overlay=true")&&(x.style.display="block"),a.uiUtil().offsetResize(n,a.options.popup));window.onresize=a.ESVS.Embedded?function(){n&&(n.style.left=a.uiUtil().getScrollLeft()+(a.uiUtil().getViewportWidth()-a.uiUtil().getNumSize(a.uiUtil().getStyle(n,"width","width")))/2+"px");y&&y()}:function(){n&&a.uiUtil().offsetResize(n,a.options.popup);y&&y()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;a.bsUtil().ahnlabInit();setTimeout(function(){t()},10)},hide:function(){a.ESVS.Embedded||(x.style.display="none",n.style.display="none")},dispose:function(g){!0==g&&4&a.ESVS.Mode&&a.nimservice()&&a.nimservice().ClearAllUserCertList(function(a,g){});window.onresize=function(){y&&y()};!a.ESVS.Embedded&&(null==a.options.popup||-1<a.options.popup.indexOf("overlay=true"))&&((g=n.parentNode)&&g.removeChild(n),x.parentNode&&x.parentNode.removeChild(x),a.uiLayerLevel-=10,a.ESVS.TabIndex-=30)}}}};