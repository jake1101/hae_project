var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(a){var b=a.document,c=a.URL||a.webkitURL||a,d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null);c.dispatchEvent(d)},l=a.webkitRequestFileSystem,h=a.requestFileSystem||l||a.mozRequestFileSystem,m=function(b){(a.setImmediate||a.setTimeout)(function(){throw b;},0)},n=0,r=[],v=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"===typeof e)try{e.call(a,c||a)}catch(f){m(f)}}},t=function(b,c){var g=this,k=b.type,m=!1,s,u,t=function(){var c=(a.URL||a.webkitURL||a).createObjectURL(b);r.push(c);return c},w=function(){v(g,["writestart","progress","write","writeend"])},p=function(){if(m||!s)s=t(b);u&&(u.location.href=s);g.readyState=g.DONE;w()},q=function(b){return function(){if(g.readyState!==g.DONE)return b.apply(this,arguments)}},x={create:!0,exclusive:!1},y;g.readyState=g.INIT;c||(c="download");e?(s=t(b),d.href=s,d.download=c,f(d),g.readyState=g.DONE,w()):(a.chrome&&k&&"application/octet-stream"!==k&&(y=b.slice||b.webkitSlice,b=y.call(b,0,b.size,"application/octet-stream"),m=!0),l&&"download"!==c&&(c+=".download"),u="application/octet-stream"===k||l?a:a.open(),h?(n+=b.size,h(a.TEMPORARY,n,q(function(a){a.root.getDirectory("saved",x,q(function(a){var d=function(){a.getFile(c,x,q(function(a){a.createWriter(q(function(c){c.onwriteend=function(b){u.location.href=a.toURL();r.push(a);g.readyState=g.DONE;v(g,"writeend",b)};c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&p()};["writestart","progress","write","abort"].forEach(function(a){c["on"+a]=g["on"+a]});c.write(b);g.abort=function(){c.abort();g.readyState=g.DONE};g.readyState=g.WRITING}),p)}),p)};a.getFile(c,{create:!1},q(function(a){a.remove();d()}),q(function(a){a.code===a.NOT_FOUND_ERR?d():p()}))}),p)}),p)):p())},k=t.prototype;k.abort=function(){this.readyState=this.DONE;v(this,"abort")};k.readyState=k.INIT=0;k.WRITING=1;k.DONE=2;k.error=k.onwritestart=k.onprogress=k.onwrite=k.onabort=k.onerror=k.onwriteend=null;a.addEventListener("unload",function(){for(var a=r.length;a--;){var b=r[a];"string"===typeof b?c.revokeObjectURL(b):b.remove()}r.length=0},!1);return function(a,b){return new t(a,b)}}(self),FILE=function(){return{toBase64:function(a){a=new Uint8Array(a);var b,c=a.length,d="";for(b=0;b<c;b+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a[b]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(a[b]&3)<<4|a[b+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(a[b+1]&15)<<2|a[b+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a[b+2]&63];2===c%3?d=d.substring(0,d.length-1)+"=":1===c%3&&(d=d.substring(0,d.length-2)+"==");return d},toArrayBuffer:function(a){var b=0.75*a.length,c=a.length,d=0,e,f,l,h;"="===a[a.length-1]&&(b--,"="===a[a.length-2]&&b--);for(var m=new ArrayBuffer(b),n=new Uint8Array(m),b=0;b<c;b+=4)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[b]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[b+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[b+2]),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[b+3]),n[d++]=e<<2|f>>4,n[d++]=(f&15)<<4|l>>2,n[d++]=(l&3)<<6|h&63;return m},Byte:{toWords:function(a){for(var b=[],c=0,d=0;c<a.length;c++,d+=8)b[d>>>5]|=(a[c]&255)<<24-d%32;return b},toHex:function(a){for(var b=[],c=0;c<a.length;c++)b.push((a[c]>>>4).toString(16)),b.push((a[c]&15).toString(16));return b.join("")},toBase64:function(a){if("function"==typeof btoa)return btoa(Binary.bytesToString(a));for(var b=[],c=0;c<a.length;c+=3)for(var d=a[c]<<16|a[c+1]<<8|a[c+2],e=0;4>e;e++)8*c+6*e<=8*a.length?b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>>6*(3-e)&63)):b.push("=");return b.join("")},toUTFString:function(a){return decodeURIComponent(escape(Binary.bytesToString(a)))},toBinString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}},Hex:{toBytes:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b}},String:{toUTFBytes:function(a){return FILE().util.Byte.stringToBytes(unescape(encodeURIComponent(a)))},toBinBytes:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c)&255);return b},toWordBytes:function(a){for(var b=[],c=0;c<32*a.length;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b}},Base64:{encode:function(a){var b="",c,d,e,f,l,h,m=0;for(a=Base64._utf8_encode(a);m<a.length;)c=a.charCodeAt(m++),d=a.charCodeAt(m++),e=a.charCodeAt(m++),f=c>>2,c=(c&3)<<4|d>>4,l=(d&15)<<2|e>>6,h=e&63,isNaN(d)?l=h=64:isNaN(e)&&(h=64),b=b+this.base64map.charAt(f)+this.base64map.charAt(c)+this.base64map.charAt(l)+this.base64map.charAt(h);return b},decode:function(a){var b="",c,d,e,f,l,h=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<a.length;)c=this.base64map.indexOf(a.charAt(h++)),d=this.base64map.indexOf(a.charAt(h++)),f=this.base64map.indexOf(a.charAt(h++)),l=this.base64map.indexOf(a.charAt(h++)),c=c<<2|d>>4,d=(d&15)<<4|f>>2,e=(f&3)<<6|l,b+=String.fromCharCode(c),64!=f&&(b+=String.fromCharCode(d)),64!=l&&(b+=String.fromCharCode(e));return b=Base64._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d,e,f=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|e&63),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(e&63)<<6|f&63),c+=3);return b}}}};