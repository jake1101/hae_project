var __certview=function(a){var w=function(k){function x(a){if(!a)return alert("UI load error."),!1;var b=document.createElement("div");document.body.insertBefore(b,document.body.firstChild);b.innerHTML=a;return!0}function r(a){a=parseInt(a);var b=document.getElementById("us-view-simple"),d=document.getElementById("us-view-detail"),f=document.getElementById("us-view-certpath"),g=document.getElementById("us-view-cert-cps-btn"),h=document.getElementById("us-view-cert-confirm-btn"),e=document.getElementById("us-view-cls-img-btn");0===a?(b.style.display="block",d.style.display="none",f&&(f.style.display="none"),g.style.display="inline",v.clearList(),g.setAttribute("tabindex",m+3,0),h.setAttribute("tabindex",m+4,0),e.setAttribute("tabindex",m+5,0)):1===a?(b.style.display="none",d.style.display="block",f&&(f.style.display="none"),g.style.display="none",v.redrawList(y.list,y.list.length),g.removeAttribute("tabindex"),h.setAttribute("tabindex",m+4,0),e.setAttribute("tabindex",m+5,0)):2===a&&(b.style.display="none",d.style.display="none",f.style.display="block",g.style.display="none",h.setAttribute("tabindex",m+5,0),e.setAttribute("tabindex",m+6,0))}function p(a,b){var d=a||window.event,d=d.target||d.srcElement,f=b.getElementsByTagName("a"),g=document.getElementById("us-view-tab-simple"),h=document.getElementById("us-view-tab-detail"),e=document.getElementById("us-view-tab-certpath");for(nTab in f)if(d==f[nTab]){isNaN(nTab)&&("us-view-tab-simple"==nTab?nTab=0:"us-view-tab-detail"==nTab?nTab=1:"us-view-tab-certpath"==nTab&&(nTab=2));0==nTab?(g.className="us-view-tab-tag active",h.className="us-view-tab-tag",e&&(e.className="us-view-tab-tag")):1==nTab?(g.className="us-view-tab-tag",h.className="us-view-tab-tag active",e&&(e.className="us-view-tab-tag")):2==nTab&&(g.className="us-view-tab-tag",h.className="us-view-tab-tag",e.className="us-view-tab-tag active");r(nTab);break}}function s(c,b,d,f){var g=null;a.usWebToolkit.x509Certificate.parser(f,d);f=a.usWebToolkit.x509Certificate.getVersion();var g=a.usWebToolkit.x509Certificate.getSerialNumber(),h=a.usWebToolkit.x509Certificate.getSignAlgo(),e=a.usWebToolkit.x509Certificate.getIssuerName(),F=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()),p=a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()),l=a.usWebToolkit.x509Certificate.getSubjectName(),k=a.usWebToolkit.x509Certificate.getPublickey(),t=a.usWebToolkit.x509Certificate.getAuthorityKeyIndentifier(),G=a.usWebToolkit.x509Certificate.getSubjectKeyIdentifier(),z=a.usWebToolkit.x509Certificate.getKeyUsage(),A=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),H=a.usWebToolkit.x509Certificate.getSubjectAltName(),r=a.usWebToolkit.x509Certificate.getAuthorityInfoAccess(),u=a.usWebToolkit.x509Certificate.getcRLDistributionPoints(),q=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS(),s=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice(),q="";try{q=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS()}catch(D){}s="";try{s=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(x){}var w=a.usWebToolkit.x509Certificate.getSignature();d=[];d[0]=f;d[1]=g;d[2]=h;d[3]=e;d[4]=F;d[5]=p;d[6]=l;d[7]=k;"MPKI"==a.ESVS.PKI?(d[8]=z,d[9]=A,d[10]=u,d[11]=w):(d[8]=t,d[9]=G,d[10]=z,d[11]=A,d[12]=H,d[13]=r,d[14]=u,d[15]=q,d[16]=s,d[17]=w);f=[];for(g=0;g<d.length;g++)h=[],h[0]=b[g].field,h[1]=d[g],f[g]=h;y=g={list:f};B=a.loadUI("gridlist");v=B({type:"detailslist",tblid:"us-view-tbl-list",tbltitleid:"us-view-tbl-list-th",titlelistid:"us-view-grid-head-div",titlerowid:"us-view-list-title-row",titleelementid:"us-view-list-title-element",titledividerid:null,titlelistcn:"us-layout-view-grid-head-div",titlerowcn:"us-layout-view-grid-head-row",titleelementcn:"us-layout-view-grid-row-title-element",titledividercn:null,tblbodyid:"us-view-tbl-list-td",datalistid:"us-view-grid-body-div",datarowid:"us-view-list-body-row",dataelementid:"us-view-list-data-element",datalistcn:"us-layout-view-grid-body-div",datarowcn:"us-layout-view-grid-body-row",dataelementcn:"us-layout-view-grid-row-data-element",dataselectcn:"us-layout-view-grid-row-data-selected-element",textboxid:"us-view-detail-text-box"});v.drawTitle(c,c.length,m+3,!1)}function u(c,b,d,f,g){if(!c||0>=b||!d||!f)return!1;var h=document.getElementById("us-view-cert-status-img"),e=document.getElementById("us-view-cert-status-msg"),m=-1;if(2==a.ESVS.Mode){b=null;try{var p=a.usWebToolkit.pki.createCaStore();b=a.PFSH.GetCACerts();for(var l in b)caCert=b[l],p.addCertificate(a.usWebToolkit.pki.certificateFromBase64(caCert));var k=a.usWebToolkit.pki.certificateFromBase64(d);a.usWebToolkit.pki.verifyCertificateChain(p,k,function(b,d,c){null!=h&&null!=e&&(!0===b?(m=0,h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_VALID)),q=!0):(m=-1,h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),null!=c&&void 0!=c&&0<=c.indexOf("Certificate is not valid yet or has expired")?e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_EXPIRED)):null!=c&&void 0!=c&&0<=c.indexOf("no parent issuer, so certificate not trusted")?e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_ISSUER_FAIL)):e.appendChild(document.createTextNode(c)),q=!1),g(m))})}catch(t){C.log("***** [Plugin Free] VerifyCertBasicAndChain exception *****"),C.log("e.code : ",t.code,"e.message : ",t.message,"e.detail : ",t.detail),a.uiUtil().errMsgBox(t.message,t.code)}}else 4&a.ESVS.Mode&&(a.nimservice()?a.nimservice().VerifyCertificate(b,1,function(b,c){if(0===b)q=!0,h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_valid.png",0),e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_VALID));else switch(q=!1,h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_invalid.png",0),b){case 3005:e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_EXPIRED));break;case 3016:case 3017:case 3900:case 3901:case 3902:case 3903:case 3904:case 3905:case 3906:case 3907:case 3908:case 3909:case 3999:e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_REVOKED));__RevokedStatus=!0;break;case 4212E4:e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_EXPIRED));__RevokedStatus=!0;break;default:e.appendChild(document.createTextNode(f.IDS_CERT_STATUS_INVALID))}g(0)}):(a.uiUtil().msgBox(__lang.IDS_MSGBOX_NIM_ERROR_UNLOAD),rv=-1,g(-1)));(function(){a.usWebToolkit.x509Certificate.parser(d,c);document.getElementById("us-view-cert-subject-name-data").appendChild(document.createTextNode(a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())));var b=document.getElementById("us-view-cert-issuer-name-data"),e=a.certUtil().getCN(a.usWebToolkit.x509Certificate.getIssuerName());if(""==e||"undefined"==e)e=a.certUtil().getO(a.usWebToolkit.x509Certificate.getIssuerName());b.appendChild(document.createTextNode(e));document.getElementById("us-view-cert-validity-date-from").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())));document.getElementById("us-view-cert-validity-date-to").appendChild(document.createTextNode(a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter())));b=document.getElementById("us-view-cert-purpose");e=null;try{e=a.usWebToolkit.x509Certificate.getCertificatePoliciesUserNotice()}catch(f){}null!=e&&b.appendChild(document.createTextNode(e));b=document.getElementById("us-view-cert-cps-btn");"MPKI"==a.ESVS.PKI&&(b.readOnly=!0,b.disabled=!0);b.onclick=function(){var b=a.usWebToolkit.x509Certificate.getCertificatePoliciesCPS();"firefox"==a.browserName?window.open(b,"cps_url","scrollbars=1"):window.open(b);this.focus()}})();return!0}function D(a){if(null==a||0==a.length)return"";for(var b=a.length,d="",f=0,g=b;f<b;f++,g--)0==g%4&&g!=b&&(d+=" "),d+=a.charAt(f);return d.toUpperCase()}function E(c,b,d,f,g){function h(a,b){var c=document.getElementById(a);c&&c.appendChild(document.createTextNode(b))}function e(a,b){var c=document.createElement("li");!0==a?c.setAttribute("class","valid"):!1==a?c.setAttribute("class","invalid"):null!=a?c.setAttribute("class",a):c.appendChild(document.createTextNode(b));return c}function m(b,c){var d=null;if(null==b||0>=b.length)return null;var e=a.usWebToolkit.x509Certificate.parser(b,c),e=a.usWebToolkit.asn1.fromDer(e.getExtension("authorityKeyIdentifier").value),f=a.usWebToolkit.util.bytesToHex(e.value[0].value);e.value[2]&&(f+="_"+parseInt(a.usWebToolkit.util.bytesToHex(e.value[2].value),16));caCerts=a.PFSH.GetCACerts();for(var g in caCerts)g.toUpperCase()==f.toUpperCase()&&(d=caCerts[g]);return d}function p(b,g,m){try{a.usWebToolkit.x509Certificate.parser(g,c);l.appendChild(e(!0));l.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));h("us-view-certpath-version",f.IDS_CERT_PATH_ROOTCA_VERSION);h("us-view-certpath-version-data",a.usWebToolkit.x509Certificate.getVersion());h("us-view-certpath-date",f.IDS_CERT_PATH_ROOTCA_VALIDDATE);h("us-view-certpath-date-from",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotBefore()));h("us-view-certpath-date-to",a.certUtil().getLocalDateNTime(a.usWebToolkit.x509Certificate.getNotAfter()));a.usWebToolkit.x509Certificate.parser(b,c);l.appendChild(e("dot"));l.appendChild(e(!0));l.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));a.usWebToolkit.x509Certificate.parser(d,c);l.appendChild(e("dot2"));l.appendChild(e(q));l.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()));var k=D(m);if(null==k||0==k.length)k="  ";h("us-view-certpath-hash",f.IDS_CERT_PATH_NOTICE);h("us-view-certpath-hash-data",k);h("us-view-certpath-tail",f.IDS_CERT_PATH_ROOTHASH_URL);h("us-view-certpath-tail",f.IDS_CERT_PATH_ROOTHASH_URL2);h("us-view-certpath-tail",f.IDS_CERT_PATH_ROOTHASH_URL3);document.getElementById("us-view-certpath-tail").onclick=function(){window.open(f.IDS_CERT_PATH_ROOTHASH_LINK,"ca_hash","scrollbars=1;width=650;height=460;")}}catch(u){a.usWebToolkit.x509Certificate.parser(d,c),l&&l.appendChild(e(q)),l&&l.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()))}}"MPKI"==a.ESVS.PKI&&g();if(4&a.ESVS.Mode&&!a.nimservice())a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD);else{var l=document.getElementById("us-view-certpath-info-tree");if(2&a.ESVS.Mode){var k=b=null;b=m(d,c);k=m(b,c);null!=b&&null!=k?p(b,k):(a.usWebToolkit.x509Certificate.parser(d,c),l&&l.appendChild(e(q)),l&&l.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName())));g()}else 4&a.ESVS.Mode&&a.nimservice().GetCACertificates(b,function(b,f,h,k,m){a.uiUtil().loadingBox(!1,"us-div-list-load");null!=l&&(0==b?p(h,k,m):(a.usWebToolkit.x509Certificate.parser(d,c),l&&l.appendChild(e(q)),l&&l.appendChild(e(null,a.usWebToolkit.x509Certificate.getSubjectName()))),g())})}}var w=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");"MPKI"==a.ESVS.PKI?c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview_verisign.html?version="+a.ver,!1):c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certview.html?version="+a.ver,!1);c.send(null);return c.responseText},I=function(){var c;c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certview_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},B=null,v=null,y=null,q=!0,m=a.ESVS.TabIndex,C=window.console||{log:function(){}};return function(){var c=eval(w),b=eval(eval(I)()),d=k.args.type,f=k.args.idx,g=k.args.cert;x(c());var h=document.getElementById("us-view-lbl-title");h.appendChild(document.createTextNode(b.IDS_CERT_VIEW));h.setAttribute("tabindex",m,0);c=document.getElementById("us-view-tab");c.onclick=function(a){p(a?a:event,this)};c.onkeydown=function(a){if((a=a?a:event)&&this){var b=a||window.event;13==(b.which||b.keyCode)&&p(a,this)}};c=document.getElementById("us-view-tab-simple");c.setAttribute("tabindex",m+1,0);c.appendChild(document.createTextNode(b.IDS_CERT_SIMPLE_VIEW));document.getElementById("us-view-simple").setAttribute("tabindex",m+2,0);c=document.getElementById("us-view-tab-detail");c.appendChild(document.createTextNode(b.IDS_CERT_DETAIL_VIEW));c.setAttribute("tabindex",m+3,0);if(c=document.getElementById("us-view-tab-certpath"))c.appendChild(document.createTextNode(b.IDS_CERT_PATH_VIEW)),c.setAttribute("tabindex",m+4,0);document.getElementById("us-view-cert-info").appendChild(document.createTextNode(b.IDS_CERT_INFO));document.getElementById("us-view-cert-subject-name").appendChild(document.createTextNode(b.IDS_CERT_SUBJECT_NAME));document.getElementById("us-view-cert-issuer-name").appendChild(document.createTextNode(b.IDS_CERT_ISSUER_NAME));document.getElementById("us-view-cert-validity-date").appendChild(document.createTextNode(b.IDS_CERT_VALIDITY_DATE));c=document.getElementById("us-view-cert-cps-btn");c.setAttribute("value",b.IDS_CERT_SUPPLEMENT_INFO,0);c.setAttribute("title",b.IDS_CERT_SUPPLEMENT_INFO+b.IDS_BUTTON,0);c.style.display="none";c=document.getElementById("us-view-cert-confirm-btn");c.setAttribute("value",b.IDS_CERT_CONFIRM,0);c.setAttribute("title",b.IDS_CERT_CONFIRM+b.IDS_BUTTON,0);c.onclick=function(){v.restoreOnMouseEvent();k.onCancel()};c=document.getElementById("us-view-cls-img-btn");c.setAttribute("title",b.IDS_CERT_VIEW_CLOSE,0);c.onclick=function(){v.restoreOnMouseEvent();k.onCancel()};c.onfocus=function(){h.focus()};document.getElementById("us-view-cls-btn-img").setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/x-btn.png",0);s([{title:b.IDS_CERT_FIELD},{title:b.IDS_CERT_VALUE}],"MPKI"==a.ESVS.PKI?[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_SIGNATURE}]:[{field:b.IDS_CERT_VERSION},{field:b.IDS_CERT_SERIAL_NUMBER},{field:b.IDS_CERT_SIGN_ALGOLISM},{field:b.IDS_CERT_ISSUER},{field:b.IDS_CERT_VALIDATE_FROM},{field:b.IDS_CERT_VALIDATE_TO},{field:b.IDS_CERT_SUBJECT},{field:b.IDS_CERT_PUBLIC_KEY},{field:b.IDS_CERT_AUTHORITY_KEY_IDENTIFIER},{field:b.IDS_CERT_SUBJECT_KEY_IDENTIFIER},{field:b.IDS_CERT_KEY_USAGE},{field:b.IDS_CERT_POLICY},{field:b.IDS_CERT_SUBJECT_ALT_NAME},{field:b.IDS_CERT_AUTHORITY_INFO_ACCESS},{field:b.IDS_CERT_CRL_DISTRIBUTE_POINTS},{field:b.IDS_CERT_CPS},{field:b.IDS_CERT_PURPOSE},{field:b.IDS_CERT_SIGNATURE}],d,g);4&a.ESVS.Mode?u(d,f,g,b,function(a){E(d,f,g,b,function(a){})}):2&a.ESVS.Mode?u(d,f,g,b,function(a){E(d,f,g,b,function(a){})}):(u(d,f,g,b),document.getElementById("us-view-tab3").style.display="none");r(0);return document.getElementById("us-div-cert-view")}()};return function(k){var x=a.uiLayerLevel,r=a.uiUtil().getOverlay(x),p=w({type:k.type,args:k.args,onConfirm:k.onConfirm,onCancel:k.onCancel});p.style.zIndex=x+1;a.ESVS.TargetObj.insertBefore(r,a.ESVS.TargetObj.firstChild);var s=window.onresize;return{show:function(){a.ActiveUI=this;draggable(p,document.getElementById("us-div-view-title"));r.style.display="block";a.uiUtil().offsetResize(p);window.onresize=function(){a.uiUtil().offsetResize(p);s&&s()};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){var a=p.getElementsByTagName("p");if(0<a.length)for(var k=0;k<a.length;k++)"us-view-lbl-title"==a[k].id&&a[k].focus()},10)},hide:function(){r.style.display="none";p.style.display="none"},dispose:function(){window.onresize=function(){s&&s()};p.parentNode.parentNode.removeChild(p.parentNode);r.parentNode.removeChild(r);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};