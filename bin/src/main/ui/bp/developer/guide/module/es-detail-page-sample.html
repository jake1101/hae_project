<dom-module id="es-detail-page-sample">
	<style>
        :host {
            @apply(--vbox-layout);
        }
    </style>
    <template>
    	<!-- 조회 -->
    	<sc-ajax id="findDetail"
				 url="json/detail-page.json"
				 body="{{param}}"
				 on-response="completeFindDetail">
	    </sc-ajax>
	    
    	<cc-page-title-bar title-text="상세 화면">
	    	<sc-button text="닫기" on-click="onClose"></sc-button>
	    </cc-page-title-bar>
	    
	    <div class="flex page">
		    
	    	<sc-panel title-text="기본정보" collapsible="true">
				<!-- form -->
				<table class="tb-form">
					<colgroup>
		        		<col style="width:120px"/>
		        		<col/>
		        		<col style="width:120px"/>
		        		<col/>
		        	</colgroup>
					<tr>
						<th>
							<sc-label text="입찰번호"></sc-label>
						</th>
						<td>
							<div class="field-box" style="width:100%">
								<sc-text-field class="w-150" value="{{rfxData.rfx_no}}" readonly></sc-text-field>
								<span style="margin:0 5px">&#47;</span>
								<sc-text-field class="w-50 align-right" value="{{rfxData.rev}}" readonly></sc-text-field>
								<span style="margin-left:5px">[[translate('차')]]</span>
							</div>
						</td>
						<th>
							<sc-label text="구매담당자"></sc-label>
						</th>
						<td>
							<sc-text-field value="{{rfxData.reg_nm}}" readonly></sc-text-field>
						</td>
					</tr>
					<tr>
						<th>
							<sc-label text="입찰명"></sc-label>
						</th>
						<td colspan="3">
							<sc-text-field value="{{rfxData.rfx_tit}}"></sc-text-field>
						</td>
					</tr>
					<tr>
		        		<th>
		        			<sc-label text="입찰설명회"></sc-label>
		        		</th>
		        		<td>
		        			<div class="field-box">
		        				<sc-button-group active-value="{{rfxData.ot_exec_yn}}" on-active-changed="onOtExecYnChanged">
			        				<sc-button text="예" value="Y"></sc-button>
			        				<sc-button text="아니오" value="N"></sc-button>
			        			</sc-button-group>
			        			<span style="margin-right:5px" hidden="{{formula('hiddenOt')}}"></span>
		        				<sc-date-field id="otStartDt" class="w-100" required="true"
												value="{{rfxData.ot_start_dt}}"
												hidden="{{formula('hiddenOt')}}">
								</sc-date-field>
								<span style="margin-right:5px" hidden="{{formula('hiddenOt')}}"></span>
								<sc-number-field id="otStartDtHour" class="w-50" min-value="0" max-value="23" max-length="2" input-cover="true" format-type="hour"
												 value="{{rfxData.ot_start_dt_hour}}" 
												 regex="/^([0-1]?[0-9]|2[0-3])$/" 
												 hidden="{{formula('hiddenOt')}}">
								</sc-number-field>
								<span style="margin:0 2px" hidden="{{formula('hiddenOt')}}"> : </span>
								<sc-number-field id="otStartDtMin" class="w-50" min-value="0" max-value="59" max-length="2" input-cover="true" format-type="hour"
												 value="{{rfxData.ot_start_dt_min}}"
												 regex="/^[0-5]?[0-9]$/"
												 hidden="{{formula('hiddenOt')}}">
								</sc-number-field>
								
		        			</div>
		        		</td>
		        		<th>
		        			<sc-label text="참석관리" hidden="{{formula('hiddenOt')}}"></sc-label>
		        		</th>
		        		<td>
		        			<sc-button-group active-value="{{rfxData.ot_vd_attend_mgt_yn}}" hidden="{{formula('hiddenOt')}}">
		        				<sc-button text="예" value="Y"></sc-button>
		        				<sc-button text="아니오" value="N"></sc-button>
		        			</sc-button-group>
		        		</td>
		        	</tr>
		        	<tr>
		        		<th>
		        			<sc-label text="제안발표회"></sc-label>
		        		</th>
		        		<td colspan="3">
		        			<div class="field-box">
		        				<sc-button-group active-value="{{rfxData.rfpann_exec_yn}}" on-active-changed="onRfpAnnExecYnChanged">
			        				<sc-button text="예" value="Y"></sc-button>
			        				<sc-button text="아니오" value="N"></sc-button>
			        			</sc-button-group>
			        			<span style="margin-right:5px"></span>
		        				<sc-date-field id="rfpannStartDt" class="w-100" required="true"
												value="{{rfxData.rfpann_start_dt}}"
												hidden="{{formula('hiddenRfpann')}}">
								</sc-date-field>
								<span style="margin-right:5px" hidden="{{formula('hiddenRfpann')}}"></span>
								<sc-number-field id="rfpannStartDtHour" class="w-50" min-value="0" max-value="23" max-length="2" input-cover="true" format-type="hour"
												 value="{{rfxData.rfpann_start_dt_hour}}" 
												 regex="/^([0-1]?[0-9]|2[0-3])$/" 
												 hidden="{{formula('hiddenRfpann')}}">
								</sc-number-field>
								<span style="margin:0 2px" hidden="{{formula('hiddenRfpann')}}"> : </span>
								<sc-number-field id="rfpannStartDtMin" class="w-50" min-value="0" max-value="59" max-length="2" input-cover="true" format-type="hour"
												 value="{{rfxData.rfpann_start_dt_min}}"
												 regex="/^[0-5]?[0-9]$/"
												 hidden="{{formula('hiddenRfpann')}}">
								</sc-number-field>
								<span style="margin:0 2px" hidden="{{formula('hiddenRfpann')}}"> ~ </span>
								<sc-number-field id="rfpannEndDtHour" class="w-50" min-value="0" max-value="23" max-length="2" input-cover="true" format-type="hour"
												 value="{{rfxData.rfpann_end_dt_hour}}" 
												 regex="/^([0-1]?[0-9]|2[0-3])$/" 
												 hidden="{{formula('hiddenRfpann')}}">
								</sc-number-field>
								<span style="margin:0 2px" hidden="{{formula('hiddenRfpann')}}"> : </span>
								<sc-number-field id="rfpannEndDtMin" class="w-50" min-value="0" max-value="59" max-length="2" input-cover="true" format-type="hour"
												 value="{{rfxData.rfpann_end_dt_min}}"
												 regex="/^[0-5]?[0-9]$/"
												 hidden="{{formula('hiddenRfpann')}}">
								</sc-number-field>
		        			</div>
		        		</td>
		        	</tr>
		        	<tr hidden="{{formula('hiddenRfpann')}}">
		        		<th>
		        			<sc-label text="제안발표회장소"></sc-label>
		        		</th>
		        		<td>
		        			<sc-text-field value="{{rfxData.rfpann_loc}}" required="true"></sc-text-field>
		        		</td>
		        		<th>
		        			<sc-label text="담당자"></sc-label>
		        		</th>
		        		<td>
		        			<sc-text-field value="{{rfxData.rfpann_chr_nm}}" required="true"></sc-text-field>
		        		</td>
		        	</tr>
				</table>
			</sc-panel>
			
			<!-- grid -->
			<sc-grid id="gridPanel" class="h-200" collapsible="true" use-dummy="false" use-selection="false" use-state="false" editable="true">
				<cc-grid-toolbar title-text="품목정보">
				</cc-grid-toolbar>
				<sc-grid-columns>
					<sc-data-column	data-field="rfx_lno"	header-text="항번"		width="50"	text-align="center"	editable="false"	data-type="number"></sc-data-column>
					<sc-data-column	data-field="item_cd"	header-text="품목코드"	width="100"	text-align="center"	editable="false"	></sc-data-column>
					<sc-data-column	data-field="item_nm"	header-text="품목명"	width="250"	text-align="left"	editable="false"	></sc-data-column>
					<sc-data-column	data-field="item_qty"	header-text="수량"		width="80"	text-align="right"	editable="false"	data-type="number"	format-type="qty"></sc-data-column>
					<sc-data-column	data-field="price"		header-text="단가"		width="120"	text-align="right"	data-type="number"	format-type="amt"></sc-data-column>
				</sc-grid-columns>
				<sc-grid-fields>
					<sc-grid-field	data-field="rfx_id"			data-type="text"></sc-grid-field>
					<sc-grid-field	data-field="rfx_no"			data-type="text"></sc-grid-field>
					<sc-grid-field	data-field="rfx_item_id"	data-type="text"></sc-grid-field>
				</sc-grid-fields>
			</sc-grid>
	    </div>
    </template>
    <script>
    Polymer({
    	is : "es-detail-page-sample",
    	properties : {
    		param : {
    			type : Object,
    			value : function() {
    				return {}
    			}
    		},
    		rfxData : {
    			type : Object,
    			value : function() {
    				return {
    					ot_exec_yn          : "N",
    					ot_vd_attend_mgt_yn : "N",
    					rfpann_exec_yn      : "N"
    				}
    			}
    		}
    	},
    	formulas : {
    		hiddenOt : function() {
				return this.rfxData.ot_exec_yn !== "Y";
			},
			hiddenRfpann : function() {
				return this.rfxData.rfpann_exec_yn !== "Y";
			}
    	},
    	initialized : function() {
    		
    	},
    	load : function(param) {
    		var me = this;
    		
    		if(UT.isNotEmpty(param)) {
	    		// 조회 파라미터 셋팅
	   			me.set("param", param);
	   			me.findDetail();
    		} else {
    			me.applyFormula();
    		}
    	},
    	// 조회
    	findDetail : function() {
    		var me = this;
    		
    		UT.request(me.$.findDetail);
    	},
    	// 조회 완료
    	completeFindDetail : function(el, res) {
    		var me = this, result = res.response;
    		
    		// 기본정보 셋팅
    		me.set("rfxData", result.rfxData);
    		
    		// 품목정보 셋팅
    		me.$.gridPanel.setDataProvider(result.rfxItemList);
    		
    		// formulas
    		me.applyFormula();
    	},
    	// 닫기
    	onClose : function() {
    		var me = this;
    		
    		// 초기화
    		me.reset();
    		
    		// close 이벤트 발생
    		me.fire("close");
    	},
    	// 입찰설명회 버튼 변경 시
    	onOtExecYnChanged : function(e, activeItem) {
			var me = this, value = activeItem.value;
			
			if(value === "N") {
				me.set("rfxData.ot_start_dt"        , null);
				me.set("rfxData.ot_start_dt_hour"   , null);
				me.set("rfxData.ot_start_dt_min"    , null);
				me.set("rfxData.ot_vd_attend_mgt_yn", "N");
			}
			me.applyFormula("hiddenOt");
		},
		// 제안발표회 버튼 변경 시
		onRfpAnnExecYnChanged : function(e, activeItem) {
			var me = this, value = activeItem.value;
			
			if(value === "N") {
				me.set("rfxData.rfpann_start_dt"     , null);
				me.set("rfxData.rfpann_start_dt_hour", null);
				me.set("rfxData.rfpann_start_dt_min" , null);
				me.set("rfxData.rfpann_end_dt_hour"  , null);
				me.set("rfxData.rfpann_end_dt_min"   , null);
			}
			me.applyFormula("hiddenRfpann");
		},
    });
    </script>
</dom-module>