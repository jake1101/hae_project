(function(){function n(h){var k=h.jsustoolkitErrCode=h.jsustoolkitErrCode||{},e=h.pkcs5=h.pkcs5||{},c=h.asn1,g=h.pki=h.pki||{};e.pbe={};var m={name:"PBES1Algorithms.params",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"PBES1Algorithms.params.salt",tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES1Algorithms.params.iterationCount",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]},n={name:"PBES2Algorithms",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},r={name:"pkcs-12PbeParams",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:c.Class.UNIVERSAL,type:c.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"iterations"}]};e.pbkdf1=function(a,b,l,f,d){if(null==a||"undefined"==typeof a)throw{code:"111001",message:k["111001"]};if(null==b||"undefined"==typeof b)throw{code:"111002",message:k["111002"]};if(null==l||"undefined"==typeof l)throw{code:"111003",message:k["111003"]};if(null==f||"undefined"==typeof f)throw{code:"111004",message:k["111004"]};if("undefined"===typeof d||null===d)d=h.md.sha1.create();if(f>4294967295*d.digestLength)throw{code:"111005",message:k["111005"]};d.start();d.update(a);a=b;for(b=1;b<=l;++b)1<b&&d.start(),d.update(a),a=d.digest().getBytes();return a};e.pbe.getCipherForPBES1=function(a,b,l){if(null==a||"undefined"==typeof a)throw{code:"111006",message:k["111006"]};if(null==b||"undefined"==typeof b)throw{code:"111007",message:k["111007"]};if(null==l||"undefined"==typeof l)throw{code:"111008",message:k["111008"]};var f={},d=[];if(!c.validate(b,m,f,d))throw{code:"111009",message:k["111009"],errors:d};var d=f.kdfSalt,p=h.util.createBuffer(f.kdfIterationCount),p=p.getInt(p.length()<<3),f=20;a===g.oids["aes128-CBC"]?f=16:a===g.oids["aes192-CBC"]?f=24:a===g.oids["aes256-CBC"]?f=32:a===g.oids.seedCBCWithSHA1?f=16:a===g.oids["seed-CBC"]&&(f=16,null==d&&(d="123456789012345"));b=h.md.sha1.create();d=h.pkcs5.pbkdf1(l,d,p,b.digestLength,b);l=d.slice(0,f);a===g.oids["seed-CBC"]?f="123456789012345":(d=d.slice(f,b.digestLength),b.start(),b.update(d),d=b.digest().getBytes(),f=d.slice(0,f));b=null;b=a===g.oids.seedCBCWithSHA1||a===g.oids["seed-CBC"]?h.seed.createDecryptionCipher(l):h.aes.createDecryptionCipher(l);b.start(f);return b};e.pbkdf2=function(a,b,l,f,d){if(null==a||"undefined"==typeof a)throw{code:"111001",message:k["111001"]};if(null==b||"undefined"==typeof b)throw{code:"111002",message:k["111002"]};if(null==l||"undefined"==typeof l)throw{code:"111003",message:k["111003"]};if(null==f||"undefined"==typeof f)throw{code:"111004",message:k["111004"]};if("undefined"===typeof d||null===d)d=h.md.sha1.create();var c=d.digestLength;if(f>4294967295*c)throw{code:"111005",message:k["111005"]};var g=Math.ceil(f/c);f-=(g-1)*c;var e=h.hmac.create();e.start(d,a);a="";for(var q,m=1;m<=g;++m){e.update(b);e.update(h.util.int32ToBytes(m));d=q=e.digest().getBytes();for(var n=2;n<=l;++n)e.start(null,null),e.update(q),q=e.digest().getBytes(),d=h.util.xorBytes(d,q,c);a+=m<g?d:d.substr(0,f)}return a};e.pbe.getCipherForPBES2=function(a,b,l){if(null==a||"undefined"==typeof a)throw{code:"111006",message:k["111006"]};if(null==b||"undefined"==typeof b)throw{code:"111007",message:k["111007"]};if(null==l||"undefined"==typeof l)throw{code:"111008",message:k["111008"]};var f={};a=[];if(!c.validate(b,n,f,a))throw{code:"111009",message:k["111009"],errors:a};a=c.derToOid(f.kdfOid);if(a!==g.oids.pkcs5PBKDF2)throw{code:"111010",message:k["111010"]+"(oid : "+a+")"};a=c.derToOid(f.encOid);if(a!==g.oids["aes128-CBC"]&&a!==g.oids["aes192-CBC"]&&a!==g.oids["aes256-CBC"]&&a!==g.oids["seed-CBC"])throw{code:"111011",message:k["111011"]+"(oid : "+a+")"};b=f.kdfSalt;var d=h.util.createBuffer(f.kdfIterationCount),d=d.getInt(d.length()<<3),e=0;a===g.oids["aes128-CBC"]?e=16:a===g.oids["aes192-CBC"]?e=24:a===g.oids["aes256-CBC"]?e=32:a===g.oids["seed-CBC"]&&(e=16);l=h.pkcs5.pbkdf2(l,b,d,e);f=f.encIv;b=null;b=a===g.oids["seed-CBC"]?h.seed.createDecryptionCipher(l):h.aes.createDecryptionCipher(l);b.start(f);return b};e.pbe.getCipherForPKCS12PBE=function(a,b,l){if(null==a||"undefined"==typeof a)throw{code:"111012",message:k["111012"]};if(null==b||"undefined"==typeof b)throw{code:"111013",message:k["111013"]};if(null==l||"undefined"==typeof l)throw{code:"111014",message:k["111014"]};var f={},d=[];if(!c.validate(b,r,f,d))throw{code:"111015",message:k["111015"],errors:d};b=h.util.createBuffer(f.salt);var f=h.util.createBuffer(f.iterations),f=f.getInt(f.length()<<3),e;switch(a){case g.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:e=24;d=8;a=h.des.startDecrypting;break;case g.oids["pbewithSHAAnd40BitRC2-CBC"]:e=5;d=8;a=function(a,b){var d=h.rc2.createDecryptionCipher(a,40);d.start(b,null);return d};break;case g.oids.seedCBCWithSHA1:d=e=16;a=h.seed.startDecrypting;break;default:throw{code:"1110133",message:k["111033"]+"(oid : "+a+")"};}e=h.pkcs12.generateKey(l,b,1,f,e);l=h.pkcs12.generateKey(l,b,2,f,d);return a(e,l)};e.pbe.setCipherForPKCS12PBE=function(a,b,e){var f=h.util.createBuffer(b.salt);b=b.count;var d,c;switch(a){case g.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:d=24;c=8;a=h.des.startEncrypting;break;case g.oids.seedCBCWithSHA1:c=d=16;a=h.seed.startEncrypting;break;default:throw{code:"1110116",message:k["111016"]+"(oid : "+a+")"};}d=h.pkcs12.generateKey(e,f,1,b,d);e=h.pkcs12.generateKey(e,f,2,b,c);return a(d,e)};e.pbe.getCipher=function(a,b,c){switch(a){case g.oids.seedCBCWithSHA1:return e.pbe.getCipherForPBES1(a,b,c);case g.oids.pkcs5PBES2:return e.pbe.getCipherForPBES2(a,b,c);case g.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case g.oids["pbewithSHAAnd40BitRC2-CBC"]:return e.pbe.getCipherForPKCS12PBE(a,b,c);default:throw{code:"1110117",message:k["111017"]+"(oid : "+a+")"};}};e.pbe.setCipher=function(a,b,c){switch(a){case g.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case g.oids["pbewithSHAAnd40BitRC2-CBC"]:return e.pbe.setCipherForPKCS12PBE(a,b,c);default:throw{code:"1110118",message:k["111018"]+"(oid : "+a+")"};}}}var r=["./hmac","./md","./util","./jsustoolkitErrCode"],m=null;"function"!==typeof define&&("object"===typeof module&&module.exports?m=function(h,k){k(require,module)}:(crosscert=window.crosscert=window.crosscert||{},n(crosscert)));(m||"function"===typeof define)&&(m||define)(["require","module"].concat(r),function(h,k){k.exports=function(e){var c=r.map(function(c){return h(c)}).concat(n);e=e||{};e.defined=e.defined||{};if(e.defined.pkcs5)return e.pkcs5;e.defined.pkcs5=!0;for(var g=0;g<c.length;++g)c[g](e);return e.pkcs5}})})();