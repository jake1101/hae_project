var __certverify=function(d){var n=function(g){function m(b,a,f){if(!b||!a)return null;var c=null;if(4&d.ESVS.Mode)if(d.nimservice())d.nimservice().VerifyCertificate(b,1,function(b,e){if(0==b)c=a.IDS_VERIFY_CERT_OK;else if("MPKI"!=d.ESVS.PKI)switch(b){case 3001:c=a.IDS_VERIFY_CERT_ERROR_INVALID_TYPE;break;case 3002:c=a.IDS_VERIFY_CERT_ERROR_DECODING_FAIL;break;case 3003:c=a.IDS_VERIFY_CERT_ERROR_LOADING_FAIL;break;case 3005:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED;break;case 3009:c=a.IDS_VERIFY_CERT_ERROR_NO_DP;break;case 3010:c=a.IDS_VERIFY_CERT_ERROR_WRONG_DP;break;case 3013:c=a.IDS_VERIFY_CERT_ERROR_WRONG_CRL+"<br><br>Code [ "+b+" ]";break;case 3014:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED_CRL;break;case 3015:c=a.IDS_VERIFY_CERT_ERROR_WRONG_CRL+"<br><br>Code [ "+b+" ]";break;case 3016:c=a.IDS_VERIFY_CERT_ERROR_HOLDED+"<br><br>Code [ "+b+" ]";break;case 3017:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+b+" ]";break;case 3059:c=a.IDS_VERIFY_CERT_ERROR_GETTING_CRL_FROM_LDAP_FAIL;break;case 3060:c=a.IDS_VERIFY_CERT_ERROR_CHECKING_ISSUER_FAIL;break;case 3062:c=a.IDS_VERIFY_CERT_ERROR_CA_CERT_PATH;break;case 3063:c=a.IDS_VERIFY_CERT_ERROR_ROOTCA_CERT_PATH;break;case 3900:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_UNSUPERSEDED;break;case 3901:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_KEYCOMPROMISE;break;case 3902:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_CACOMPROMISE;break;case 3903:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_AFFILIATIONCHANGED;break;case 3904:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_SUPERSEDED;break;case 3905:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_CESSATIONOFOPERATION;break;case 3906:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_HOLD;break;case 3907:c=a.IDS_VERIFY_CERT_ERROR_REVOKED_REMOVEFROMCRL;break;case 3908:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+b+" ]";break;case 3909:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+b+" ]";break;case 3999:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+b+" ]";break;default:c=a.IDS_VERIFY_CERT_ERROR_UNKNOWN+"<br><br>Code [ "+b+" ]"}else switch(b){case 3001:c=a.IDS_VERIFY_CERT_ERROR_INVALID_TYPE;break;case 3002:c=a.IDS_VERIFY_CERT_ERROR_DECODING_FAIL;break;case 3003:c=a.IDS_VERIFY_CERT_ERROR_LOADING_FAIL;break;case 3005:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED;break;case 3009:c=a.IDS_VERIFY_CERT_ERROR_NO_DP;break;case 3010:c=a.IDS_VERIFY_CERT_ERROR_WRONG_DP;break;case 3013:c=a.IDS_VERIFY_CERT_ERROR_WRONG_CRL+"<br><br>Code [ "+b+" ]";break;case 3014:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED_CRL;break;case 3015:c=a.IDS_VERIFY_CERT_ERROR_WRONG_CRL+"<br><br>Code [ "+b+" ]";break;case 3059:c=a.IDS_VERIFY_CERT_ERROR_GETTING_CRL_FROM_LDAP_FAIL;break;case 3060:c=a.IDS_VERIFY_CERT_ERROR_CHECKING_ISSUER_FAIL;break;case 3062:c=a.IDS_VERIFY_CERT_ERROR_CA_CERT_PATH;break;case 3063:c=a.IDS_VERIFY_CERT_ERROR_ROOTCA_CERT_PATH;break;case 3016:case 3017:case 3900:case 3901:case 3902:case 3903:case 3904:case 3905:case 3906:case 3907:case 3908:case 3909:case 3999:c=a.IDS_VERIFY_CERT_ERROR_REVOKED+"<br><br>Code [ "+b+" ]";break;case 4212E4:c=a.IDS_VERIFY_CERT_ERROR_EXPIRED+"<br>Code [ "+b+" ]";break;default:c=a.IDS_VERIFY_CERT_ERROR_UNKNOWN+"<br><br>Code [ "+b+" ]"}f(c)});else return d.uiUtil().msgBox(a.IDS_MSGBOX_NIM_ERROR_UNLOAD),c=null;else if(2==d.ESVS.Mode){var e=null;try{var l=d.usWebToolkit.pki.createCaStore(),e=d.PFSH.GetCACerts(),g;for(g in e)caCert=e[g],l.addCertificate(d.usWebToolkit.pki.certificateFromBase64(caCert));if(null==d.certsList||null==d.certsList.list||0>=d.certsList.list.length)return"";var h=d.usWebToolkit.pki.certificateFromBase64(d.certsList.list[b-1].cert);d.usWebToolkit.pki.verifyCertificateChain(l,h,function(b,d,e){!0===b?(result=0,c=a.IDS_VERIFY_CERT_OK):(result=-1,null!=e&&void 0!=e&&0<=e.indexOf("Certificate is not valid yet or has expired")?(errCode=3005,c=a.IDS_VERIFY_CERT_ERROR_EXPIRED):null!=e&&void 0!=e&&0<=e.indexOf("no parent issuer, so certificate not trusted")?(errCode=3060,c=a.IDS_VERIFY_CERT_ERROR_CHECKING_ISSUER_FAIL):(errCode=-1,c=e));f(c)})}catch(k){errCode=k.code,c=k.message,f(c)}}}function h(b){if(!b)return alert("UI load error."),!1;var a=document.createElement("div");document.body.insertBefore(a,document.body.firstChild);a.innerHTML=b;return!0}var e=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",d.ESVS.SRCPath+"unisignweb/rsrc/layout/certverify.html?version="+d.ver,!1);b.send(null);return b.responseText},k=function(){var b;b=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");b.open("GET",d.ESVS.SRCPath+"unisignweb/rsrc/lang/"+d.ESVS.Language+"/certverify_"+d.ESVS.Language+".js?version="+d.ver,!1);b.send(null);return b.responseText},l=d.ESVS.TabIndex;return function(){var b=eval(e),a=eval(eval(k)()),f=g.args.idx;h(b());b=document.getElementById("us-cert-verify-lbl-title");b.appendChild(document.createTextNode(a.IDS_VERIFY_CERT));b.setAttribute("tabindex",l,0);4&d.ESVS.Mode||2&d.ESVS.Mode?m(f,a,function(a){var b=document.getElementById("us-cert-verify-lbl");a&&b&&(b.innerHTML=a,b.setAttribute("tabindex",l+1,0))}):(f=m(f,a),b=document.getElementById("us-cert-verify-lbl"),f&&b&&(b.innerHTML=f,b.setAttribute("tabindex",l+1,0)));f=document.getElementById("us-cert-verify-confirm-btn");f.setAttribute("value",a.IDS_CONFIRM,0);f.setAttribute("title",a.IDS_CONFIRM+a.IDS_BUTTON,0);f.setAttribute("tabindex",l+2,0);f.onclick=function(){g.onConfirm()};f=document.getElementById("us-cert-verify-cls-img-btn");f.setAttribute("title",a.IDS_VERIFY_CERT_CLOSE,0);f.setAttribute("tabindex",l+3,0);f.onclick=function(){g.onCancel()};document.getElementById("us-cert-verify-cls-btn-img").setAttribute("src",d.ESVS.SRCPath+"unisignweb/rsrc/img/x-btn.png",0);return document.getElementById("us-div-cert-verify")}()};return function(g){var m=d.uiLayerLevel,h=d.uiUtil().getOverlay(m),e=n({type:g.type,args:g.args,onConfirm:g.onConfirm,onCancel:g.onCancel});e.style.zIndex=m+1;d.ESVS.TargetObj.insertBefore(h,d.ESVS.TargetObj.firstChild);var k=window.onresize;return{show:function(){d.ActiveUI=this;draggable(e,document.getElementById("us-div-cert-verify-title"));h.style.display="block";d.uiUtil().offsetResize(e);window.onresize=function(){d.uiUtil().offsetResize(e);k&&k()};d.uiLayerLevel+=10;d.ESVS.TabIndex+=30;setTimeout(function(){var d=e.getElementsByTagName("p");if(0<d.length)for(var b=0;b<d.length;b++)"us-cert-verify-lbl-title"==d[b].id&&d[b].focus()},10)},hide:function(){h.style.display="none";e.style.display="none"},dispose:function(){window.onresize=function(){k&&k()};e.parentNode.parentNode.removeChild(e.parentNode);h.parentNode.removeChild(h);d.uiLayerLevel-=10;d.ESVS.TabIndex-=30}}}};