<sc-link rel="import" href="ep-company-apply-service-apply.html"></sc-link>

<dom-module id="es-company-apply-service-list">
	<template>
		<sc-request-group init>
			<sc-ajax 
				id="regSafetyServiceGroupList" 
				url="regSafetyServiceGroupList.do" 
				last-response="{{svcGrpObj}}"
			></sc-ajax>
			<sc-ajax 
				id="findRegSafetyServiceList"
				url="findRegSafetyServiceList.do"
				body="{{searchParam}}"
				last-response="{{serviceList}}"
			></sc-ajax>
		</sc-request-group>
		
		<cc-sub-title-bar title-text="서비스 목록"></cc-sub-title-bar>
		<cc-search-container on-search="onFindRegSafetyServiceList">
			<table>
				<colgroup>
					<col style="width: 100px;">
					<col>
					<col style="width: 100px;">
					<col>
				</colgroup>
				<tr style="height: 50px;">
					<th>
						<sc-label text="서비스 그룹"></sc-label>
					</th>
                	<td>
                		<sc-combobox-field 
                			id="grpCbBox"
                			value="{{searchParam.svc_grp_id}}" 
                			items="{{groupList}}"
                			display-field="svc_grp_nm"
                			value-field="svc_grp_id"
                			placeholder="그룹명"
                		></sc-combobox-field>
                	</td>
					<th>
						<sc-label text="키워드 검색"></sc-label>
					</th>
					<td>
						<sc-text-field value="{{searchParam.search}}"></sc-text-field>
					</td>
				</tr>
				<tr></tr>
			</table>
		</cc-search-container>
		<sc-grid 
			id="gridPanel" 
			data-provider="{{serviceList}}" 
			on-item-click="onItemClick"
			on-button-click="onItemClick"
			use-selection="false"
			use-state="false"
			editable="true"
		>
			<cc-grid-toolbar></cc-grid-toolbar>
			<sc-grid-columns>
				<sc-data-column 
					data-field="svc_grp_nm" 
					header-text="서비스 그룹" 
					width="500" 
					text-align="center"
				></sc-data-column>
				<sc-data-column
					data-field="svc_ctl_nm" 
					header-text="서비스 명"   
					width="600" 
					text-align="center"
				></sc-data-column>
				<sc-button-column
					data-field="apply_btn"
					header-text="신청"
					text="신청"
				>
				</sc-button-column>
			</sc-grid-columns>
		</sc-grid>
    </template>
    <script>
    	Polymer({
    		is: "es-company-apply-service-list",
    		properties: {
    			searchParam: {
    				type: Object,
    				value: function() {
    					return {};
    				}
    			},
    			groupList: {
    				type: Array,
    				value: function() {
    					return []
    				}
    			},
    			serviceList:  {
    				type: Array,
    				value: function() {
    					return [];
    				}
    			},
    			svcGrpObj: {
    				type: Object,
    				value: function() {
    					return {};
    				}
    			}
    		},
    		initialized: function() {
    			UT.request(this.$.regSafetyServiceGroupList)
    			
                const me = this;               
    			const groupObj = me.get("svcGrpObj") || {};
                me.set("groupList", groupObj.result_data);
                
                const list = me.get("groupList") || [];
                list.unshift({svc_grp_id: "", svc_grp_nm: "전체"})
                
    			me.onFindRegSafetyServiceList();
            },
    		onFindRegSafetyServiceList: function() {
                console.log(this.get("searchParam"))
    			UT.request(this.$.findRegSafetyServiceList);
                console.log(this.get("serviceList"))
    		},
    		onItemClick: function() {
    			const me = this,
	                  {data: d} = event.detail,
             		  {columnName: cn} = event.detail.item;
             		  
    			switch(cn){
    			case "apply_btn":
   	    			const applyPop = UT.popup(
    					"ep-company-apply-service-apply", 
    					me,
    					800,
    					800,
    					{
    						"close": function(popup, e) {
    							popup.close();
    						}
    					},
    					{ 
    						maximizable: true, 
    						titleText: `${d.svc_ctl_nm} 신청하기`
    					}
   	    			);
   	    			applyPop.show();
   	    			applyPop.getWindowContent().load(d)
    				break;
    			default:
    				break;
    			}
    		}
    	})
    </script>
</dom-module>