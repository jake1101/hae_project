<sc-link rel="import" href="ep-company-search-service-detail.html"></sc-link>

<dom-module id="es-company-search-service-list">
	<template>
		<sc-request-group init>
			<sc-ajax 
				id="regSafetyServiceGroupList" 
				url="regSafetyServiceGroupList.do" 
				last-response="{{svcGrpObj}}"
			></sc-ajax>
			<sc-ajax 
				id="findRegSafetyServiceList"
				url="findRegSafetyServiceList.do"
				body="{{searchParam}}"
				last-response="{{serviceList}}"
			></sc-ajax>
		</sc-request-group>
		
		<cc-sub-title-bar title-text="서비스 목록"></cc-sub-title-bar>
		<cc-search-container on-search="onFindRegSafetyServiceList">
			<table>
				<colgroup>
					<col style="width: 100px;">
					<col>
					<col style="width: 100px;">
					<col>
				</colgroup>
				<tr style="height: 50px;">
					<th>
						<sc-label text="서비스 그룹"></sc-label>
					</th>
                	<td>
                		<sc-combobox-field 
                			id="grpCbBox"
                			value="{{searchParam.svc_grp_id}}" 
                			items="{{groupList}}"
                			display-field="svc_grp_nm"
                			value-field="svc_grp_id"
                			placeholder="그룹명"
                		></sc-combobox-field>
                	</td>
					<th>
						<sc-label text="키워드 검색"></sc-label>
					</th>
					<td>
						<sc-text-field value="{{searchParam.search}}"></sc-text-field>
					</td>
				</tr>
				<tr></tr>
			</table>
		</cc-search-container>
		<sc-grid 
			id="gridPanel" 
			data-provider="{{serviceList}}" 
			on-item-click="onItemClick"
			on-button-click="onItemClick"
			use-selection="false"
			use-state="false"
			editable="true"
		>
			<cc-grid-toolbar></cc-grid-toolbar>
			<sc-grid-columns>
				<sc-data-column 
					data-field="svc_grp_nm" 
					header-text="서비스 그룹" 
					width="500" 
					text-align="center"
				></sc-data-column>
				<sc-data-column
					data-field="svc_ctl_nm"
					header-text="서비스 명"  
					width="600" 
					text-align="center"
				 	style-name="link"
				></sc-data-column>
				</sc-button-column>
			</sc-grid-columns>
		</sc-grid>
    </template>
    <script>
    	Polymer({
    		is: "es-company-search-service-list",
    		properties: {
    			searchParam: {
    				type: Object,
    				value: function() {
    					return {};
    				}
    			},
    			groupList: {
    				type: Array,
    				value: function() {
    					return []
    				}
    			},
    			serviceList:  {
    				type: Array,
    				value: function() {
    					return [];
    				}
    			},
    			svcGrpObj: {
    				type: Object,
    				value: function() {
    					return {};
    				}
    			}
    		},
    		initialized: function() {
    			UT.request(this.$.regSafetyServiceGroupList)
    			
                const me = this;               
    			const groupObj = me.get("svcGrpObj") || {};
                me.set("groupList", groupObj.result_data);
                
                const list = me.get("groupList") || [];
                list.unshift({svc_grp_id: "", svc_grp_nm: "전체"})
                
    			me.onFindRegSafetyServiceList();
            },
    		onFindRegSafetyServiceList: function() {
    			const me = this;
    			UT.request(me.$.findRegSafetyServiceList);
    		},
    		onItemClick: function() {
    			const me = this;
    			const {data: d} = event.detail;
             	const {columnName: cn} = event.detail.item;
             		  
       		 	if(cn == "svc_ctl_nm"){
					const { svc_ctl_nm } = d;
	    			me.popup = UT.popup(
	  					"ep-company-search-service-detail", 
	  					me,
	  					800,
	  					800,
	  					{},
	  					{ 
	  						maximizable: true, 
	  						titleText: `${svc_ctl_nm} 자세히 보기`
	  					}
	    			);
	    			me.popup.show();
	    			me.popup.getWindowContent().load(d)
				}
    		}
    	})
    </script>
</dom-module>