!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){function r(e,t,n){for(var r=0,i=e.length;r<i;r++)u.call(e,r)&&t.call(n,e[r],r,e)}function i(e,t,n){for(var r=0,i=e.length;r<i;r++)t.call(n,e.charAt(r),r,e)}function o(e,t,n){for(var r in e)u.call(e,r)&&t.call(n,e[r],r,e)}var s=e("is-function");t.exports=function(e,t,n){if(!s(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===a.call(e)?r(e,t,n):"string"==typeof e?i(e,t,n):o(e,t,n)};var a=Object.prototype.toString,u=Object.prototype.hasOwnProperty},{"is-function":3}],2:[function(e,t,n){(function(e){var n;n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){t.exports=function(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)};var r=Object.prototype.toString},{}],4:[function(e,t,n){var r=e("trim"),i=e("for-each"),o=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return i(r(e).split("\n"),function(e){var n=e.indexOf(":"),i=r(e.slice(0,n)).toLowerCase(),s=r(e.slice(n+1));void 0===t[i]?t[i]=s:o(t[i])?t[i].push(s):t[i]=[t[i],s]}),t}},{"for-each":1,trim:5}],5:[function(e,t,n){(n=t.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},n.right=function(e){return e.replace(/\s*$/,"")}},{}],6:[function(e,t,n){"use strict";function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function i(e,t,n){var r=e;return c(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=f(t,{uri:e}),r.callback=n,r}function o(e,t,n){return t=i(e,t,n),s(t)}function s(e){function t(){var e=void 0;if(e=c.response?c.response:c.responseText||a(c),b)try{e=JSON.parse(e)}catch(e){}return e}function n(e){return clearTimeout(d),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,u(e,_)}function i(){if(!h){var n;clearTimeout(d),n=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var r=_,i=null;return 0!==n?(r={body:t(),statusCode:n,method:v,headers:{},url:p,rawRequest:c},c.getAllResponseHeaders&&(r.headers=l(c.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),u(i,r,r.body)}}if(void 0===e.callback)throw new Error("callback argument missing");var s=!1,u=function(t,n,r){s||(s=!0,e.callback(t,n,r))},c=e.xhr||null;c||(c=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var f,h,d,p=c.url=e.uri||e.url,v=c.method=e.method||"GET",y=e.body||e.data,g=c.headers=e.headers||{},w=!!e.sync,b=!1,_={body:void 0,headers:{},statusCode:0,method:v,url:p,rawRequest:c};if("json"in e&&!1!==e.json&&(b=!0,g.accept||g.Accept||(g.Accept="application/json"),"GET"!==v&&"HEAD"!==v&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),y=JSON.stringify(!0===e.json?y:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(i,0)},c.onload=i,c.onerror=n,c.onprogress=function(){},c.onabort=function(){h=!0},c.ontimeout=n,c.open(v,p,!w,e.username,e.password),w||(c.withCredentials=!!e.withCredentials),!w&&e.timeout>0&&(d=setTimeout(function(){if(!h){h=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",n(e)}},e.timeout)),c.setRequestHeader)for(f in g)g.hasOwnProperty(f)&&c.setRequestHeader(f,g[f]);else if(e.headers&&!r(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(y||null),c}function a(e){if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}var u=e("global/window"),c=e("is-function"),l=e("parse-headers"),f=e("xtend");t.exports=o,o.XMLHttpRequest=u.XMLHttpRequest||function(){},o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:u.XDomainRequest,function(e,t){for(var n=0;n<e.length;n++)t(e[n])}(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,n,r){return n=i(t,n,r),n.method=e.toUpperCase(),s(n)}})},{"global/window":2,"is-function":3,"parse-headers":4,xtend:7}],7:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}],8:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./scene-integrator"));n.default=r.default,"undefined"!=typeof window&&(window.SceneIntegrator=r.default),void 0!==t&&(t.SceneIntegrator=r.default)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./scene-integrator":9}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("xhr"),s=function(){function e(t){r(this,e);var n=t.baseURL,i=t.withCredentials,o=t.authorizationKey,s=t.authorizationType,a=t.fit,u=t.license;this.baseURL=n,this.withCredentials=i,this.authorizationKey=o,this.authorizationType=s,this.fitMode=a,scene&&scene.license(u)}return i(e,null,[{key:"instance",value:function(t){return this._instance||(this._instance=new e(t)),this._instance}},{key:"help",value:function(e){e||console.info("\n      ")}}]),i(e,[{key:"_createSceneProvider",value:function(){return new scene.ReferenceMap(function(e){this.requests.push(e),1==this.requests.length&&this._onRequestSent();var t=scene.create({model:{},mode:0,refProvider:this.sceneProvider});return t.app.baseUrl=this.baseURL,t}.bind(this),function(e,t){var n;for(var r in this.sceneNames)this.sceneNames[r]===t&&(n=r);delete this.sceneNames[n]}.bind(this))}},{key:"integrate",value:function(e){var t=e.target,n=e.sceneName;return this.show(n,t)}},{key:"createSceneWrapper",value:function(){var e=document.createElement("div");return e.style.width=e.style.height="100%",e.style.position="relative",e.setAttribute("class","scene-wrapper"),e.forward=[],e.backward=[],e.next=function(){var t=e.forward.pop();t&&(e.scene&&(e.scene.target=null,this._unbindAllEvents(t._container,this),e.backward.push(e.scene)),e.scene=t,e.scene.target=e,this._bindAllEvents(e.scene._container,this))}.bind(this),e.prev=function(){var t=e.backward.pop();t&&(e.scene&&(e.scene.target=null,this._unbindAllEvents(t._container,this),e.forward.push(e.scene)),e.scene=t,e.scene.target=e,this._bindAllEvents(e.scene._container,this))}.bind(this),e}},{key:"httpRequest",value:function(e,t,n){t=t||{},Object.assign(t,{url:e,method:this.method,headers:this.httpHeaders,withCredentials:this.withCredentials}),n||(n=this.defaultCallback),o(t,n)}},{key:"fit",value:function(e,t){t.fit(e||this.fitMode)}},{key:"show",value:function(e,t){return this.targetEl=t,this._releaseRef(this.targetEl),this._showScene(e)}},{key:"_showScene",value:function(e,t){if(e){var n;if(t){var r=(n=t.origin.target).scene;n==r.target&&(n.backward.push(r),r.target=null)}var i=(n||this.targetEl).scene=this.sceneProvider.get(e,!0);if(i.target!==(n||this.targetEl))return(n||this.targetEl).forward.forEach(function(e){e.release()}),(n||this.targetEl).forward=[],t||((n||this.targetEl).backward.forEach(function(e){e.release()}),(n||this.targetEl).backward=[]),i.target=n||this.targetEl,this._bindAllEvents(i._container,this),this.fit(this.fitMode,i),i;i.release()}}},{key:"_releaseRef",value:function(e){e&&e.scene&&(this._unbindAllEvents(e.scene._container,this),e.scene.release(),e.scene.target=null,e.scene.dispose(),delete e.scene,e.forward.forEach(function(e){e.release()}),e.forward=[],e.backward.forEach(function(e){e.release()}),e.backward=[])}},{key:"_onBaseUrlChanged",value:function(e){this.scene&&(this.scene.app.baseUrl=e)}},{key:"_onRequestSent",value:function(){for(var e;void 0===e&&this.requests.length>0;)e=this.requests.shift();void 0!==e&&(this.boardName=e,this.httpRequest(this.baseURL+"/scenes/"+e,null,this._onResponseGetScene.bind(this)))}},{key:"_onResponseGetScene",value:function(e,t,n){var r=JSON.parse(n);if(r){var i=this.sceneProvider.get(r.name);if(i){i.model=JSON.parse(r.model),i.fit("both"),i.release();var o=r.name;this.sceneNames[o]=i}else console.error("BUG")}}},{key:"_bindAllEvents",value:function(e,t){for(var n in this.eventMap)if(this.eventMap.hasOwnProperty(n)){var r=this[this.eventMap[n]];e.on(n,r,t)}}},{key:"_unbindAllEvents",value:function(e,t){for(var n in this.eventMap)if(this.eventMap.hasOwnProperty(n)){var r=this[this.eventMap[n]];e.off(n,r,t)}}},{key:"targetEl",get:function(){return this._targetEl},set:function(e){this._targetEl="string"==typeof e?document.getElementById(e):e;var t;if(this._targetEl.children&&this._targetEl.children.length>0)for(var n in this._targetEl.children){var r=this._targetEl.children[n];if("scene-wrapper"==r.getAttribute("class")){t=r;break}}t||(t=this.createSceneWrapper(),this._targetEl.appendChild(t)),this._targetEl=t}},{key:"baseURL",get:function(){return this._baseURL||"http://localhost/rest"},set:function(e){this._baseURL=e,this._onBaseUrlChanged(e)}},{key:"contentType",get:function(){return"application/json"}},{key:"authorizationType",get:function(){return this._authorizationType||"token"},set:function(e){this._authorizationType=e}},{key:"authorizationKey",get:function(){return this._authorizationKey},set:function(e){this._authorizationKey=e}},{key:"httpHeaders",get:function(){return{"Content-Type":this.contentType,"Authorization-Type":this.authorizationType,"Authorization-Key":this.authorizationKey}}},{key:"withCredentials",get:function(){return this._withCredentials},set:function(e){this._withCredentials=e||!1}},{key:"defaultCallback",get:function(){return function(e,t,n){console.log(e,n)}}},{key:"scene",get:function(){return this._scene},set:function(e){this._scene=e}},{key:"fitMode",get:function(){return this._fitMode||"both"},set:function(e){this._fitMode=e}},{key:"sceneProvider",get:function(){return this._sceneProvider||(this._sceneProvider=this._createSceneProvider()),this._sceneProvider}},{key:"requests",get:function(){return this._requests||(this._requests=[]),this._requests}},{key:"sceneNames",get:function(){return this._sceneNames||(this._sceneNames={}),this._sceneNames}},{key:"eventMap",get:function(){return{goto:"_showScene","stop-playing":"_historyBack","link-open":"_openWebpageByUrl","link-href":"_setLocationHref"}}}]),e}();n.default=s},{xhr:6}]},{},[8]);